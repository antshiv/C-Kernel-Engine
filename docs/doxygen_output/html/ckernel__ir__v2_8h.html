<!-- Doxygen custom header with link back to main docs -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ckernel_ir_v2.h File Reference</title>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<style>
/* Back to docs banner */
.docs-banner {
    background: linear-gradient(135deg, #2a2a2a 0%, #363636 50%, #2a2a2a 100%);
    border-bottom: 3px solid #ffb400;
    padding: 0.5rem 1rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}
.docs-banner a {
    color: #ffb400;
    text-decoration: none;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}
.docs-banner a:hover {
    color: #ffc933;
}
.docs-banner .logo {
    background: #ffb400;
    color: #1d1d1d;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-weight: 700;
    font-family: monospace;
}
.docs-banner .subtitle {
    color: #707070;
    font-size: 0.85rem;
}
</style>
</head>
<body>
<div class="docs-banner">
    <a href="../index.html">
        <span class="logo">CK</span>
        <span>‚Üê Back to C-Kernel-Engine Docs</span>
    </a>
    <span class="subtitle">Doxygen Source Documentation</span>
</div>
<div id="top">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('ckernel__ir__v2_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">ckernel_ir_v2.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="ckernel__ir_8h_source.html">ckernel_ir.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="ckernel__kernel__specs_8h_source.html">ckernel_kernel_specs.h</a>&quot;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
</div>
<p><a href="ckernel__ir__v2_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCKIRV2Binding.html">CKIRV2Binding</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCKIRV2Buffer.html">CKIRV2Buffer</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCKIRV2Graph.html">CKIRV2Graph</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCKIRV2Node.html">CKIRV2Node</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a0ee7790c95183c6bfb4e941096fab601"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ckernel__ir__v2_8h.html#a0ee7790c95183c6bfb4e941096fab601">CK_IR_V2_MAX_BINDINGS</a>&#160;&#160;&#160;24</td></tr>
<tr class="separator:a0ee7790c95183c6bfb4e941096fab601"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a058176b4def706d5a0e1e2e37f472ede"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ckernel__ir__v2_8h.html#a058176b4def706d5a0e1e2e37f472ede">CK_IR_V2_MAX_DIMS</a>&#160;&#160;&#160;4</td></tr>
<tr class="separator:a058176b4def706d5a0e1e2e37f472ede"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaabbb4fa50030e014cc46c48ac42c25d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ckernel__ir__v2_8h.html#aaabbb4fa50030e014cc46c48ac42c25d">CK_IR_V2_MAX_INPUTS</a>&#160;&#160;&#160;8</td></tr>
<tr class="separator:aaabbb4fa50030e014cc46c48ac42c25d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a20a2600398e0320fbef06ee7ce4682ec"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ckernel__ir__v2_8h.html#a20a2600398e0320fbef06ee7ce4682ec">CK_IR_V2_MAX_OUTPUTS</a>&#160;&#160;&#160;4</td></tr>
<tr class="separator:a20a2600398e0320fbef06ee7ce4682ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:ac6a19aa94348b33702ba27f461574cb5"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ckernel__ir__v2_8h.html#ac6a19aa94348b33702ba27f461574cb5">CKIRV2NodeFlags</a> { <a class="el" href="ckernel__ir__v2_8h.html#ac6a19aa94348b33702ba27f461574cb5ae66b9baa0fff3ce291efd21eab738da3">CK_IR_V2_NODE_NONE</a> = 0
, <a class="el" href="ckernel__ir__v2_8h.html#ac6a19aa94348b33702ba27f461574cb5a2fa704b530b5d37125fb869e8525978e">CK_IR_V2_NODE_FUSED</a> = 1 &lt;&lt; 0
, <a class="el" href="ckernel__ir__v2_8h.html#ac6a19aa94348b33702ba27f461574cb5ae176b4a1e2034abbe0a9d96a548a7cb2">CK_IR_V2_NODE_INFERENCE_ONLY</a> = 1 &lt;&lt; 1
 }</td></tr>
<tr class="separator:ac6a19aa94348b33702ba27f461574cb5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a6ca70d7ee0aba15ab3c49671f848e20d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ckernel__ir__v2_8h.html#a6ca70d7ee0aba15ab3c49671f848e20d">ck_ir_v2_apply_meta</a> (const char *path, <a class="el" href="structCKIRV2Graph.html">CKIRV2Graph</a> *graph)</td></tr>
<tr class="separator:a6ca70d7ee0aba15ab3c49671f848e20d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a80f105580f1785ac4dfcccf2496389e7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ckernel__ir__v2_8h.html#a80f105580f1785ac4dfcccf2496389e7">ck_ir_v2_build_decoder</a> (const <a class="el" href="structCKModelConfig.html">CKModelConfig</a> *cfg, <a class="el" href="structCKIRV2Graph.html">CKIRV2Graph</a> *graph)</td></tr>
<tr class="separator:a80f105580f1785ac4dfcccf2496389e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad34447264bfb018e6d5f856c5fcff1f3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ckernel__ir__v2_8h.html#ad34447264bfb018e6d5f856c5fcff1f3">ck_ir_v2_build_decoder_backward</a> (const <a class="el" href="structCKIRV2Graph.html">CKIRV2Graph</a> *forward, <a class="el" href="structCKIRV2Graph.html">CKIRV2Graph</a> *backward)</td></tr>
<tr class="separator:ad34447264bfb018e6d5f856c5fcff1f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a681eb8d191d9589d6ff0ecb59536c671"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ckernel__ir__v2_8h.html#a681eb8d191d9589d6ff0ecb59536c671">ck_ir_v2_free</a> (<a class="el" href="structCKIRV2Graph.html">CKIRV2Graph</a> *graph)</td></tr>
<tr class="separator:a681eb8d191d9589d6ff0ecb59536c671"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a823b147ca06c5f9073e6eaedff358bb1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ckernel__ir__v2_8h.html#a823b147ca06c5f9073e6eaedff358bb1">ck_ir_v2_parse_json</a> (const char *path, <a class="el" href="structCKIRV2Graph.html">CKIRV2Graph</a> *graph)</td></tr>
<tr class="separator:a823b147ca06c5f9073e6eaedff358bb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6cdd7c6d88800527b0c3633beecd077d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ckernel__ir__v2_8h.html#a6cdd7c6d88800527b0c3633beecd077d">ck_ir_v2_serialize_json</a> (const <a class="el" href="structCKIRV2Graph.html">CKIRV2Graph</a> *graph, const char *path)</td></tr>
<tr class="separator:a6cdd7c6d88800527b0c3633beecd077d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3b6c997fea78e5e450c1007074ec0ae2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ckernel__ir__v2_8h.html#a3b6c997fea78e5e450c1007074ec0ae2">ck_ir_v2_serialize_json_with_plan</a> (const <a class="el" href="structCKIRV2Graph.html">CKIRV2Graph</a> *graph, const struct <a class="el" href="structCKMemPlan.html">CKMemPlan</a> *plan, const char *mode, int tokens_override, int base_context_window, const char *path)</td></tr>
<tr class="separator:a3b6c997fea78e5e450c1007074ec0ae2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a0ee7790c95183c6bfb4e941096fab601"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0ee7790c95183c6bfb4e941096fab601">&#9670;&nbsp;</a></span>CK_IR_V2_MAX_BINDINGS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CK_IR_V2_MAX_BINDINGS&#160;&#160;&#160;24</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ckernel__ir__v2_8h_source.html#l00016">16</a> of file <a class="el" href="ckernel__ir__v2_8h_source.html">ckernel_ir_v2.h</a>.</p>

</div>
</div>
<a id="a058176b4def706d5a0e1e2e37f472ede"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a058176b4def706d5a0e1e2e37f472ede">&#9670;&nbsp;</a></span>CK_IR_V2_MAX_DIMS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CK_IR_V2_MAX_DIMS&#160;&#160;&#160;4</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ckernel__ir__v2_8h_source.html#l00013">13</a> of file <a class="el" href="ckernel__ir__v2_8h_source.html">ckernel_ir_v2.h</a>.</p>

</div>
</div>
<a id="aaabbb4fa50030e014cc46c48ac42c25d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaabbb4fa50030e014cc46c48ac42c25d">&#9670;&nbsp;</a></span>CK_IR_V2_MAX_INPUTS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CK_IR_V2_MAX_INPUTS&#160;&#160;&#160;8</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ckernel__ir__v2_8h_source.html#l00014">14</a> of file <a class="el" href="ckernel__ir__v2_8h_source.html">ckernel_ir_v2.h</a>.</p>

</div>
</div>
<a id="a20a2600398e0320fbef06ee7ce4682ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a20a2600398e0320fbef06ee7ce4682ec">&#9670;&nbsp;</a></span>CK_IR_V2_MAX_OUTPUTS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CK_IR_V2_MAX_OUTPUTS&#160;&#160;&#160;4</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ckernel__ir__v2_8h_source.html#l00015">15</a> of file <a class="el" href="ckernel__ir__v2_8h_source.html">ckernel_ir_v2.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="ac6a19aa94348b33702ba27f461574cb5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac6a19aa94348b33702ba27f461574cb5">&#9670;&nbsp;</a></span>CKIRV2NodeFlags</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="ckernel__ir__v2_8h.html#ac6a19aa94348b33702ba27f461574cb5">CKIRV2NodeFlags</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="ac6a19aa94348b33702ba27f461574cb5ae66b9baa0fff3ce291efd21eab738da3"></a>CK_IR_V2_NODE_NONE&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="ac6a19aa94348b33702ba27f461574cb5a2fa704b530b5d37125fb869e8525978e"></a>CK_IR_V2_NODE_FUSED&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="ac6a19aa94348b33702ba27f461574cb5ae176b4a1e2034abbe0a9d96a548a7cb2"></a>CK_IR_V2_NODE_INFERENCE_ONLY&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="ckernel__ir__v2_8h_source.html#l00018">18</a> of file <a class="el" href="ckernel__ir__v2_8h_source.html">ckernel_ir_v2.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;             {</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    <a class="code" href="ckernel__ir__v2_8h.html#ac6a19aa94348b33702ba27f461574cb5ae66b9baa0fff3ce291efd21eab738da3">CK_IR_V2_NODE_NONE</a> = 0,</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <a class="code" href="ckernel__ir__v2_8h.html#ac6a19aa94348b33702ba27f461574cb5a2fa704b530b5d37125fb869e8525978e">CK_IR_V2_NODE_FUSED</a> = 1 &lt;&lt; 0,</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <a class="code" href="ckernel__ir__v2_8h.html#ac6a19aa94348b33702ba27f461574cb5ae176b4a1e2034abbe0a9d96a548a7cb2">CK_IR_V2_NODE_INFERENCE_ONLY</a> = 1 &lt;&lt; 1</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;} <a class="code" href="ckernel__ir__v2_8h.html#ac6a19aa94348b33702ba27f461574cb5">CKIRV2NodeFlags</a>;</div>
<div class="ttc" id="ackernel__ir__v2_8h_html_ac6a19aa94348b33702ba27f461574cb5"><div class="ttname"><a href="ckernel__ir__v2_8h.html#ac6a19aa94348b33702ba27f461574cb5">CKIRV2NodeFlags</a></div><div class="ttdeci">CKIRV2NodeFlags</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00018">ckernel_ir_v2.h:18</a></div></div>
<div class="ttc" id="ackernel__ir__v2_8h_html_ac6a19aa94348b33702ba27f461574cb5a2fa704b530b5d37125fb869e8525978e"><div class="ttname"><a href="ckernel__ir__v2_8h.html#ac6a19aa94348b33702ba27f461574cb5a2fa704b530b5d37125fb869e8525978e">CK_IR_V2_NODE_FUSED</a></div><div class="ttdeci">@ CK_IR_V2_NODE_FUSED</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00020">ckernel_ir_v2.h:20</a></div></div>
<div class="ttc" id="ackernel__ir__v2_8h_html_ac6a19aa94348b33702ba27f461574cb5ae176b4a1e2034abbe0a9d96a548a7cb2"><div class="ttname"><a href="ckernel__ir__v2_8h.html#ac6a19aa94348b33702ba27f461574cb5ae176b4a1e2034abbe0a9d96a548a7cb2">CK_IR_V2_NODE_INFERENCE_ONLY</a></div><div class="ttdeci">@ CK_IR_V2_NODE_INFERENCE_ONLY</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00022">ckernel_ir_v2.h:21</a></div></div>
<div class="ttc" id="ackernel__ir__v2_8h_html_ac6a19aa94348b33702ba27f461574cb5ae66b9baa0fff3ce291efd21eab738da3"><div class="ttname"><a href="ckernel__ir__v2_8h.html#ac6a19aa94348b33702ba27f461574cb5ae66b9baa0fff3ce291efd21eab738da3">CK_IR_V2_NODE_NONE</a></div><div class="ttdeci">@ CK_IR_V2_NODE_NONE</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00019">ckernel_ir_v2.h:19</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a6ca70d7ee0aba15ab3c49671f848e20d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ca70d7ee0aba15ab3c49671f848e20d">&#9670;&nbsp;</a></span>ck_ir_v2_apply_meta()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ck_ir_v2_apply_meta </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structCKIRV2Graph.html">CKIRV2Graph</a> *&#160;</td>
          <td class="paramname"><em>graph</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ckernel__ir__v2__builder_8c_source.html#l00220">220</a> of file <a class="el" href="ckernel__ir__v2__builder_8c_source.html">ckernel_ir_v2_builder.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;{</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keywordflow">if</span> (!path || !graph) {</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    }</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    FILE *f = fopen(path, <span class="stringliteral">&quot;rb&quot;</span>);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordflow">if</span> (!f) {</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        perror(<span class="stringliteral">&quot;ck_ir_v2_apply_meta: fopen&quot;</span>);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    }</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordflow">if</span> (fseek(f, 0, SEEK_END) != 0) {</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        fclose(f);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    }</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keywordtype">long</span> len = ftell(f);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="keywordflow">if</span> (len &lt; 0) {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        fclose(f);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    }</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">if</span> (fseek(f, 0, SEEK_SET) != 0) {</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        fclose(f);</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordtype">char</span> *buf = (<span class="keywordtype">char</span> *)malloc((<span class="keywordtype">size_t</span>)len + 1);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordflow">if</span> (!buf) {</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        fclose(f);</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    }</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="keywordtype">size_t</span> nread = fread(buf, 1, (<span class="keywordtype">size_t</span>)len, f);</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    fclose(f);</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    buf[nread] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *end = buf + nread;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <span class="keywordtype">int</span> val = 0;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ckernel__ir__v2__builder_8c.html#a39594713511ebb496afee8c67c18c60b">ck_ir_v2_parse_bool</a>(buf, <span class="stringliteral">&quot;\&quot;has_pos_emb\&quot;&quot;</span>, end, &amp;val) == 0) {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        graph-&gt;<a class="code" href="structCKIRV2Graph.html#a520e755b859ef64a2f7299c9472e9911">has_pos_emb</a> = val ? 1 : 0;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    }</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ckernel__ir__v2__builder_8c.html#a39594713511ebb496afee8c67c18c60b">ck_ir_v2_parse_bool</a>(buf, <span class="stringliteral">&quot;\&quot;tie_word_embeddings\&quot;&quot;</span>, end, &amp;val) == 0) {</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        graph-&gt;<a class="code" href="structCKIRV2Graph.html#a5296e6ba849fa74670cf9290065ac2c9">tie_word_embeddings</a> = val ? 1 : 0;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <span class="keywordflow">if</span> (graph-&gt;<a class="code" href="structCKIRV2Graph.html#a5296e6ba849fa74670cf9290065ac2c9">tie_word_embeddings</a> == 0) {</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            <span class="keywordtype">int</span> idx = <a class="code" href="ckernel__ir__v2__builder_8c.html#ad0ca6b1fd812a332aa86eef694f67a8f">ck_ir_v2_find_buffer_index</a>(graph, <span class="stringliteral">&quot;lm_head_weight&quot;</span>);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;            <span class="keywordflow">if</span> (idx &gt;= 0) {</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                free(graph-&gt;<a class="code" href="structCKIRV2Graph.html#ad2d61568dda8232b3252da14a53ffc03">buffers</a>[idx].<a class="code" href="structCKIRV2Buffer.html#a92f6356a2149550923b521d604bc9486">alias_of</a>);</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                graph-&gt;<a class="code" href="structCKIRV2Graph.html#ad2d61568dda8232b3252da14a53ffc03">buffers</a>[idx].<a class="code" href="structCKIRV2Buffer.html#a92f6356a2149550923b521d604bc9486">alias_of</a> = NULL;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;            }</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;            <span class="keywordtype">int</span> idx = <a class="code" href="ckernel__ir__v2__builder_8c.html#ad0ca6b1fd812a332aa86eef694f67a8f">ck_ir_v2_find_buffer_index</a>(graph, <span class="stringliteral">&quot;lm_head_weight&quot;</span>);</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;            <span class="keywordflow">if</span> (idx &gt;= 0) {</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                free(graph-&gt;<a class="code" href="structCKIRV2Graph.html#ad2d61568dda8232b3252da14a53ffc03">buffers</a>[idx].<a class="code" href="structCKIRV2Buffer.html#a92f6356a2149550923b521d604bc9486">alias_of</a>);</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                graph-&gt;<a class="code" href="structCKIRV2Graph.html#ad2d61568dda8232b3252da14a53ffc03">buffers</a>[idx].<a class="code" href="structCKIRV2Buffer.html#a92f6356a2149550923b521d604bc9486">alias_of</a> = <a class="code" href="ckernel__ir__v2__builder_8c.html#a104bb744263fc943e02e9fb5e66632bf">ck_ir_v2_strdup</a>(<span class="stringliteral">&quot;token_emb&quot;</span>);</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            }</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        }</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    }</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ckernel__ir__v2__builder_8c.html#a39594713511ebb496afee8c67c18c60b">ck_ir_v2_parse_bool</a>(buf, <span class="stringliteral">&quot;\&quot;fused_qkv\&quot;&quot;</span>, end, &amp;val) == 0) {</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        graph-&gt;<a class="code" href="structCKIRV2Graph.html#adfc2e02d30a154499cfa803b1095dc6a">fused_qkv</a> = val ? 1 : 0;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    }</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ckernel__ir__v2__builder_8c.html#a39594713511ebb496afee8c67c18c60b">ck_ir_v2_parse_bool</a>(buf, <span class="stringliteral">&quot;\&quot;gated_mlp\&quot;&quot;</span>, end, &amp;val) == 0) {</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        graph-&gt;<a class="code" href="structCKIRV2Graph.html#a6e330ed95df881c765d7fbb5f5c62d35">gated_mlp</a> = val ? 1 : 0;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    }</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    (void)<a class="code" href="ckernel__ir__v2__builder_8c.html#a1878230b08b02341da1bbcab15e6950f">ck_ir_v2_apply_weight_dtypes</a>(buf, end, graph);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160; </div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    free(buf);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;}</div>
<div class="ttc" id="ackernel__ir__v2__builder_8c_html_a104bb744263fc943e02e9fb5e66632bf"><div class="ttname"><a href="ckernel__ir__v2__builder_8c.html#a104bb744263fc943e02e9fb5e66632bf">ck_ir_v2_strdup</a></div><div class="ttdeci">static char * ck_ir_v2_strdup(const char *s)</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2__builder_8c_source.html#l00008">ckernel_ir_v2_builder.c:8</a></div></div>
<div class="ttc" id="ackernel__ir__v2__builder_8c_html_a1878230b08b02341da1bbcab15e6950f"><div class="ttname"><a href="ckernel__ir__v2__builder_8c.html#a1878230b08b02341da1bbcab15e6950f">ck_ir_v2_apply_weight_dtypes</a></div><div class="ttdeci">static int ck_ir_v2_apply_weight_dtypes(const char *json, const char *end, CKIRV2Graph *graph)</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2__builder_8c_source.html#l00174">ckernel_ir_v2_builder.c:174</a></div></div>
<div class="ttc" id="ackernel__ir__v2__builder_8c_html_a39594713511ebb496afee8c67c18c60b"><div class="ttname"><a href="ckernel__ir__v2__builder_8c.html#a39594713511ebb496afee8c67c18c60b">ck_ir_v2_parse_bool</a></div><div class="ttdeci">static int ck_ir_v2_parse_bool(const char *json, const char *key, const char *end, int *out)</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2__builder_8c_source.html#l00139">ckernel_ir_v2_builder.c:139</a></div></div>
<div class="ttc" id="ackernel__ir__v2__builder_8c_html_ad0ca6b1fd812a332aa86eef694f67a8f"><div class="ttname"><a href="ckernel__ir__v2__builder_8c.html#ad0ca6b1fd812a332aa86eef694f67a8f">ck_ir_v2_find_buffer_index</a></div><div class="ttdeci">static int ck_ir_v2_find_buffer_index(const CKIRV2Graph *graph, const char *name)</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2__builder_8c_source.html#l00044">ckernel_ir_v2_builder.c:44</a></div></div>
<div class="ttc" id="astructCKIRV2Buffer_html_a92f6356a2149550923b521d604bc9486"><div class="ttname"><a href="structCKIRV2Buffer.html#a92f6356a2149550923b521d604bc9486">CKIRV2Buffer::alias_of</a></div><div class="ttdeci">char * alias_of</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00031">ckernel_ir_v2.h:31</a></div></div>
<div class="ttc" id="astructCKIRV2Graph_html_a520e755b859ef64a2f7299c9472e9911"><div class="ttname"><a href="structCKIRV2Graph.html#a520e755b859ef64a2f7299c9472e9911">CKIRV2Graph::has_pos_emb</a></div><div class="ttdeci">int has_pos_emb</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00057">ckernel_ir_v2.h:57</a></div></div>
<div class="ttc" id="astructCKIRV2Graph_html_a5296e6ba849fa74670cf9290065ac2c9"><div class="ttname"><a href="structCKIRV2Graph.html#a5296e6ba849fa74670cf9290065ac2c9">CKIRV2Graph::tie_word_embeddings</a></div><div class="ttdeci">int tie_word_embeddings</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00058">ckernel_ir_v2.h:58</a></div></div>
<div class="ttc" id="astructCKIRV2Graph_html_a6e330ed95df881c765d7fbb5f5c62d35"><div class="ttname"><a href="structCKIRV2Graph.html#a6e330ed95df881c765d7fbb5f5c62d35">CKIRV2Graph::gated_mlp</a></div><div class="ttdeci">int gated_mlp</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00060">ckernel_ir_v2.h:60</a></div></div>
<div class="ttc" id="astructCKIRV2Graph_html_ad2d61568dda8232b3252da14a53ffc03"><div class="ttname"><a href="structCKIRV2Graph.html#ad2d61568dda8232b3252da14a53ffc03">CKIRV2Graph::buffers</a></div><div class="ttdeci">CKIRV2Buffer * buffers</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00062">ckernel_ir_v2.h:62</a></div></div>
<div class="ttc" id="astructCKIRV2Graph_html_adfc2e02d30a154499cfa803b1095dc6a"><div class="ttname"><a href="structCKIRV2Graph.html#adfc2e02d30a154499cfa803b1095dc6a">CKIRV2Graph::fused_qkv</a></div><div class="ttdeci">int fused_qkv</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00059">ckernel_ir_v2.h:59</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ckernel__ir__v2_8h_source.html#l00031">CKIRV2Buffer::alias_of</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00062">CKIRV2Graph::buffers</a>, <a class="el" href="ckernel__ir__v2__builder_8c_source.html#l00174">ck_ir_v2_apply_weight_dtypes()</a>, <a class="el" href="ckernel__ir__v2__builder_8c_source.html#l00044">ck_ir_v2_find_buffer_index()</a>, <a class="el" href="ckernel__ir__v2__builder_8c_source.html#l00139">ck_ir_v2_parse_bool()</a>, <a class="el" href="ckernel__ir__v2__builder_8c_source.html#l00008">ck_ir_v2_strdup()</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00059">CKIRV2Graph::fused_qkv</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00060">CKIRV2Graph::gated_mlp</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00057">CKIRV2Graph::has_pos_emb</a>, and <a class="el" href="ckernel__ir__v2_8h_source.html#l00058">CKIRV2Graph::tie_word_embeddings</a>.</p>

<p class="reference">Referenced by <a class="el" href="ckernel__ir__v2__demo_8c_source.html#l00025">main()</a>.</p>

</div>
</div>
<a id="a80f105580f1785ac4dfcccf2496389e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a80f105580f1785ac4dfcccf2496389e7">&#9670;&nbsp;</a></span>ck_ir_v2_build_decoder()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ck_ir_v2_build_decoder </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structCKModelConfig.html">CKModelConfig</a> *&#160;</td>
          <td class="paramname"><em>cfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structCKIRV2Graph.html">CKIRV2Graph</a> *&#160;</td>
          <td class="paramname"><em>graph</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ckernel__ir__v2__builder_8c_source.html#l00285">285</a> of file <a class="el" href="ckernel__ir__v2__builder_8c_source.html">ckernel_ir_v2_builder.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;{</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    <span class="keywordflow">if</span> (!cfg || !graph) {</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    }</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    memset(graph, 0, <span class="keyword">sizeof</span>(*graph));</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    graph-&gt;<a class="code" href="structCKIRV2Graph.html#a49f1785b410e7bcae526d0b1dec440f3">config</a> = *cfg;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    graph-&gt;<a class="code" href="structCKIRV2Graph.html#a520e755b859ef64a2f7299c9472e9911">has_pos_emb</a> = 1;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    graph-&gt;<a class="code" href="structCKIRV2Graph.html#a5296e6ba849fa74670cf9290065ac2c9">tie_word_embeddings</a> = -1;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    graph-&gt;<a class="code" href="structCKIRV2Graph.html#adfc2e02d30a154499cfa803b1095dc6a">fused_qkv</a> = -1;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    graph-&gt;<a class="code" href="structCKIRV2Graph.html#a6e330ed95df881c765d7fbb5f5c62d35">gated_mlp</a> = -1;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    graph-&gt;<a class="code" href="structCKIRV2Graph.html#aeb72a3027aef579daf9a4ac090ac71ba">num_buffers</a> = (int)<a class="code" href="ckernel__kernel__specs_8h.html#ae9be980801e3c3b9e00b575e2eb132bd">ck_decoder_buffer_count</a>;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    graph-&gt;<a class="code" href="structCKIRV2Graph.html#ad2d61568dda8232b3252da14a53ffc03">buffers</a> = (<a class="code" href="structCKIRV2Buffer.html">CKIRV2Buffer</a> *)calloc((<span class="keywordtype">size_t</span>)graph-&gt;<a class="code" href="structCKIRV2Graph.html#aeb72a3027aef579daf9a4ac090ac71ba">num_buffers</a>, <span class="keyword">sizeof</span>(<a class="code" href="structCKIRV2Buffer.html">CKIRV2Buffer</a>));</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    <span class="keywordflow">if</span> (!graph-&gt;<a class="code" href="structCKIRV2Graph.html#ad2d61568dda8232b3252da14a53ffc03">buffers</a>) {</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    }</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; graph-&gt;<a class="code" href="structCKIRV2Graph.html#aeb72a3027aef579daf9a4ac090ac71ba">num_buffers</a>; ++i) {</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="ckernel__ir__v2__builder_8c.html#a29e53bd4efe76f71f9f493bd6ca03364">ck_ir_v2_copy_buffer_spec</a>(&amp;<a class="code" href="ckernel__kernel__specs_8h.html#ad9257c11ae490b3da865862c61a8c5cf">ck_decoder_buffers</a>[i], &amp;graph-&gt;<a class="code" href="structCKIRV2Graph.html#ad2d61568dda8232b3252da14a53ffc03">buffers</a>[i]) != 0) {</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            <a class="code" href="ckernel__ir__v2_8h.html#a681eb8d191d9589d6ff0ecb59536c671">ck_ir_v2_free</a>(graph);</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        }</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <span class="keywordflow">if</span> (graph-&gt;<a class="code" href="structCKIRV2Graph.html#ad2d61568dda8232b3252da14a53ffc03">buffers</a>[i].<a class="code" href="structCKIRV2Buffer.html#a2f431336505aa19000ed2535be85bc71">name</a> &amp;&amp; strcmp(graph-&gt;<a class="code" href="structCKIRV2Graph.html#ad2d61568dda8232b3252da14a53ffc03">buffers</a>[i].<a class="code" href="structCKIRV2Buffer.html#a2f431336505aa19000ed2535be85bc71">name</a>, <span class="stringliteral">&quot;pos_emb&quot;</span>) == 0) {</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            free(graph-&gt;<a class="code" href="structCKIRV2Graph.html#ad2d61568dda8232b3252da14a53ffc03">buffers</a>[i].<a class="code" href="structCKIRV2Buffer.html#a50f6cc398851b0c231520444e855113b">condition</a>);</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            graph-&gt;<a class="code" href="structCKIRV2Graph.html#ad2d61568dda8232b3252da14a53ffc03">buffers</a>[i].<a class="code" href="structCKIRV2Buffer.html#a50f6cc398851b0c231520444e855113b">condition</a> = <a class="code" href="ckernel__ir__v2__builder_8c.html#a104bb744263fc943e02e9fb5e66632bf">ck_ir_v2_strdup</a>(<span class="stringliteral">&quot;has_pos_emb&quot;</span>);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        }</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    }</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160; </div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordtype">int</span> plan_count = (int)<a class="code" href="ckernel__kernel__specs_8h.html#a5313b833dc861ada85f37e9ef379dee3">ck_decoder_forward_plan_v2_count</a>;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    graph-&gt;<a class="code" href="structCKIRV2Graph.html#ae0b967575703465657a56a64d12164ed">num_nodes</a> = cfg-&gt;<a class="code" href="structCKModelConfig.html#a01453afe2f69986d9ca04a10f7b9d0a4">num_layers</a> * plan_count;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    graph-&gt;<a class="code" href="structCKIRV2Graph.html#a82745ad41882ae6c770f18a7759b23f6">nodes</a> = (<a class="code" href="structCKIRV2Node.html">CKIRV2Node</a> *)calloc((<span class="keywordtype">size_t</span>)graph-&gt;<a class="code" href="structCKIRV2Graph.html#ae0b967575703465657a56a64d12164ed">num_nodes</a>, <span class="keyword">sizeof</span>(<a class="code" href="structCKIRV2Node.html">CKIRV2Node</a>));</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordflow">if</span> (!graph-&gt;<a class="code" href="structCKIRV2Graph.html#a82745ad41882ae6c770f18a7759b23f6">nodes</a>) {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <a class="code" href="ckernel__ir__v2_8h.html#a681eb8d191d9589d6ff0ecb59536c671">ck_ir_v2_free</a>(graph);</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    }</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160; </div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keywordtype">int</span> idx = 0;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> layer = 0; layer &lt; cfg-&gt;<a class="code" href="structCKModelConfig.html#a01453afe2f69986d9ca04a10f7b9d0a4">num_layers</a>; ++layer) {</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> p = 0; p &lt; plan_count; ++p) {</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            <span class="keyword">const</span> <a class="code" href="structCKPlanStepV2.html">CKPlanStepV2</a> *step = &amp;<a class="code" href="ckernel__kernel__specs_8h.html#a2ca67fec5e711b5cbdde5b1c602b949e">ck_decoder_forward_plan_v2</a>[p];</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            <span class="keyword">const</span> <a class="code" href="structCKKernelSpec.html">CKKernelSpec</a> *spec = <a class="code" href="ckernel__ir__v2__builder_8c.html#af49195eecf6a337b1d16a56ed0e37922">ck_ir_v2_find_kernel_spec</a>(step-&gt;<a class="code" href="structCKPlanStepV2.html#a1762220af86b81c437f4290195e928b1">kernel</a>);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            <a class="code" href="ckernel__dtype_8h.html#a9d2373b6c685cf9421a6fb638964aa65">CKDataType</a> dtype = spec ? spec-&gt;<a class="code" href="structCKKernelSpec.html#a851ca16066a7dfa2499bee69cfef2360">default_dtype</a> : <a class="code" href="ckernel__dtype_8h.html#a9d2373b6c685cf9421a6fb638964aa65a9b7d39257d8dd8044a4012bc6db08e2b">CK_DT_FP32</a>;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">char</span> *impl = <a class="code" href="ckernel__ir__v2__builder_8c.html#a2a289dfc861e40f2cc178fd95b37b0e5">ck_ir_v2_select_kernel</a>(spec, dtype, 0);</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            <a class="code" href="structCKIRV2Node.html">CKIRV2Node</a> *node = &amp;graph-&gt;<a class="code" href="structCKIRV2Graph.html#a82745ad41882ae6c770f18a7759b23f6">nodes</a>[idx++];</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            node-&gt;<a class="code" href="structCKIRV2Node.html#a830105276be359268bb949e27e406ae7">layer</a> = (uint16_t)layer;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            node-&gt;<a class="code" href="structCKIRV2Node.html#a4b5b83070cfaad5ecc383e411decd713">op</a> = <a class="code" href="ckernel__ir__v2__builder_8c.html#a104bb744263fc943e02e9fb5e66632bf">ck_ir_v2_strdup</a>(step-&gt;<a class="code" href="structCKPlanStepV2.html#a1762220af86b81c437f4290195e928b1">kernel</a>);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            node-&gt;<a class="code" href="structCKIRV2Node.html#ae7e891c0c72b3a0c726e416696299de9">kernel</a> = <a class="code" href="ckernel__ir__v2__builder_8c.html#a104bb744263fc943e02e9fb5e66632bf">ck_ir_v2_strdup</a>(impl ? impl : step-&gt;<a class="code" href="structCKPlanStepV2.html#a1762220af86b81c437f4290195e928b1">kernel</a>);</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            node-&gt;<a class="code" href="structCKIRV2Node.html#abd1f5cc6077e8a035d8a2f0d69d30a48">kernel_dtype</a> = dtype;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            node-&gt;<a class="code" href="structCKIRV2Node.html#a719657d39bb8a3107906b072969e77f9">condition</a> = <a class="code" href="ckernel__ir__v2__builder_8c.html#a104bb744263fc943e02e9fb5e66632bf">ck_ir_v2_strdup</a>(step-&gt;<a class="code" href="structCKPlanStepV2.html#a22d5d759ab81944a97689a1a80456664">condition</a>);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            node-&gt;<a class="code" href="structCKIRV2Node.html#a8888fb53fa56aeaa19e4e0af16c30667">flags</a> = 0;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            node-&gt;<a class="code" href="structCKIRV2Node.html#a47c09e1e5f659536f5ae6f0abb4b061a">n_bindings</a> = 0;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            <span class="keywordflow">if</span> (step-&gt;<a class="code" href="structCKPlanStepV2.html#acaaa916701cbcf1e9a5d35ff79e7c5bf">bindings</a> &amp;&amp; step-&gt;<a class="code" href="structCKPlanStepV2.html#a99fd1a750634dd8160937d173e7acf31">num_bindings</a> &gt; 0) {</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                <span class="keywordtype">int</span> limit = (int)step-&gt;<a class="code" href="structCKPlanStepV2.html#a99fd1a750634dd8160937d173e7acf31">num_bindings</a>;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                if (limit &gt; <a class="code" href="ckernel__ir__v2_8h.html#a0ee7790c95183c6bfb4e941096fab601">CK_IR_V2_MAX_BINDINGS</a>) {</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                    limit = <a class="code" href="ckernel__ir__v2_8h.html#a0ee7790c95183c6bfb4e941096fab601">CK_IR_V2_MAX_BINDINGS</a>;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                }</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> b = 0; b &lt; limit; ++b) {</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                    <span class="keyword">const</span> <a class="code" href="structCKPlanBinding.html">CKPlanBinding</a> *binding = &amp;step-&gt;<a class="code" href="structCKPlanStepV2.html#acaaa916701cbcf1e9a5d35ff79e7c5bf">bindings</a>[b];</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                    node-&gt;<a class="code" href="structCKIRV2Node.html#a8c7183052806860180f236095880ec04">bindings</a>[node-&gt;<a class="code" href="structCKIRV2Node.html#a47c09e1e5f659536f5ae6f0abb4b061a">n_bindings</a>].<a class="code" href="structCKIRV2Binding.html#a0e50855a2852b3018c3b87ae5e53db19">arg</a> = <a class="code" href="ckernel__ir__v2__builder_8c.html#a104bb744263fc943e02e9fb5e66632bf">ck_ir_v2_strdup</a>(binding-&gt;<a class="code" href="structCKPlanBinding.html#adf2dd85574e578a94cd1fc656d077505">arg</a>);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                    node-&gt;<a class="code" href="structCKIRV2Node.html#a8c7183052806860180f236095880ec04">bindings</a>[node-&gt;<a class="code" href="structCKIRV2Node.html#a47c09e1e5f659536f5ae6f0abb4b061a">n_bindings</a>].<a class="code" href="structCKIRV2Binding.html#acbaa32705fa3caa147f63c8beecd6fe5">buffer</a> =</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                        <a class="code" href="ckernel__ir__v2__builder_8c.html#ad0ca6b1fd812a332aa86eef694f67a8f">ck_ir_v2_find_buffer_index</a>(graph, binding-&gt;<a class="code" href="structCKPlanBinding.html#a86cd6b157f1489dc20f7558c5a69c94f">buffer</a>);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                    node-&gt;<a class="code" href="structCKIRV2Node.html#a47c09e1e5f659536f5ae6f0abb4b061a">n_bindings</a>++;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                }</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            }</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            node-&gt;<a class="code" href="structCKIRV2Node.html#aef9c006f01df1247d1858ab622791f0a">n_inputs</a> = 0;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            node-&gt;<a class="code" href="structCKIRV2Node.html#ad351fdec7e39e8af9d29b729f8c0196b">n_outputs</a> = 0;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        }</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    }</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;}</div>
<div class="ttc" id="ackernel__dtype_8h_html_a9d2373b6c685cf9421a6fb638964aa65"><div class="ttname"><a href="ckernel__dtype_8h.html#a9d2373b6c685cf9421a6fb638964aa65">CKDataType</a></div><div class="ttdeci">CKDataType</div><div class="ttdoc">Supported data types in C-Kernel-Engine.</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__dtype_8h_source.html#l00025">ckernel_dtype.h:25</a></div></div>
<div class="ttc" id="ackernel__dtype_8h_html_a9d2373b6c685cf9421a6fb638964aa65a9b7d39257d8dd8044a4012bc6db08e2b"><div class="ttname"><a href="ckernel__dtype_8h.html#a9d2373b6c685cf9421a6fb638964aa65a9b7d39257d8dd8044a4012bc6db08e2b">CK_DT_FP32</a></div><div class="ttdeci">@ CK_DT_FP32</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__dtype_8h_source.html#l00027">ckernel_dtype.h:27</a></div></div>
<div class="ttc" id="ackernel__ir__v2_8h_html_a0ee7790c95183c6bfb4e941096fab601"><div class="ttname"><a href="ckernel__ir__v2_8h.html#a0ee7790c95183c6bfb4e941096fab601">CK_IR_V2_MAX_BINDINGS</a></div><div class="ttdeci">#define CK_IR_V2_MAX_BINDINGS</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00016">ckernel_ir_v2.h:16</a></div></div>
<div class="ttc" id="ackernel__ir__v2_8h_html_a681eb8d191d9589d6ff0ecb59536c671"><div class="ttname"><a href="ckernel__ir__v2_8h.html#a681eb8d191d9589d6ff0ecb59536c671">ck_ir_v2_free</a></div><div class="ttdeci">void ck_ir_v2_free(CKIRV2Graph *graph)</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8c_source.html#l00034">ckernel_ir_v2.c:34</a></div></div>
<div class="ttc" id="ackernel__ir__v2__builder_8c_html_a29e53bd4efe76f71f9f493bd6ca03364"><div class="ttname"><a href="ckernel__ir__v2__builder_8c.html#a29e53bd4efe76f71f9f493bd6ca03364">ck_ir_v2_copy_buffer_spec</a></div><div class="ttdeci">static int ck_ir_v2_copy_buffer_spec(const CKBufferSpec *spec, CKIRV2Buffer *out)</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2__builder_8c_source.html#l00027">ckernel_ir_v2_builder.c:27</a></div></div>
<div class="ttc" id="ackernel__ir__v2__builder_8c_html_a2a289dfc861e40f2cc178fd95b37b0e5"><div class="ttname"><a href="ckernel__ir__v2__builder_8c.html#a2a289dfc861e40f2cc178fd95b37b0e5">ck_ir_v2_select_kernel</a></div><div class="ttdeci">static const char * ck_ir_v2_select_kernel(const CKKernelSpec *spec, CKDataType dtype, int backward)</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2__builder_8c_source.html#l00070">ckernel_ir_v2_builder.c:70</a></div></div>
<div class="ttc" id="ackernel__ir__v2__builder_8c_html_af49195eecf6a337b1d16a56ed0e37922"><div class="ttname"><a href="ckernel__ir__v2__builder_8c.html#af49195eecf6a337b1d16a56ed0e37922">ck_ir_v2_find_kernel_spec</a></div><div class="ttdeci">static const CKKernelSpec * ck_ir_v2_find_kernel_spec(const char *name)</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2__builder_8c_source.html#l00057">ckernel_ir_v2_builder.c:57</a></div></div>
<div class="ttc" id="ackernel__kernel__specs_8h_html_a2ca67fec5e711b5cbdde5b1c602b949e"><div class="ttname"><a href="ckernel__kernel__specs_8h.html#a2ca67fec5e711b5cbdde5b1c602b949e">ck_decoder_forward_plan_v2</a></div><div class="ttdeci">const CKPlanStepV2 ck_decoder_forward_plan_v2[]</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__kernel__specs_8c_source.html#l00313">ckernel_kernel_specs.c:313</a></div></div>
<div class="ttc" id="ackernel__kernel__specs_8h_html_a5313b833dc861ada85f37e9ef379dee3"><div class="ttname"><a href="ckernel__kernel__specs_8h.html#a5313b833dc861ada85f37e9ef379dee3">ck_decoder_forward_plan_v2_count</a></div><div class="ttdeci">const size_t ck_decoder_forward_plan_v2_count</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__kernel__specs_8c_source.html#l00327">ckernel_kernel_specs.c:327</a></div></div>
<div class="ttc" id="ackernel__kernel__specs_8h_html_ad9257c11ae490b3da865862c61a8c5cf"><div class="ttname"><a href="ckernel__kernel__specs_8h.html#ad9257c11ae490b3da865862c61a8c5cf">ck_decoder_buffers</a></div><div class="ttdeci">const CKBufferSpec ck_decoder_buffers[]</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__kernel__specs_8c_source.html#l00003">ckernel_kernel_specs.c:3</a></div></div>
<div class="ttc" id="ackernel__kernel__specs_8h_html_ae9be980801e3c3b9e00b575e2eb132bd"><div class="ttname"><a href="ckernel__kernel__specs_8h.html#ae9be980801e3c3b9e00b575e2eb132bd">ck_decoder_buffer_count</a></div><div class="ttdeci">const size_t ck_decoder_buffer_count</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__kernel__specs_8c_source.html#l00083">ckernel_kernel_specs.c:83</a></div></div>
<div class="ttc" id="astructCKIRV2Binding_html_a0e50855a2852b3018c3b87ae5e53db19"><div class="ttname"><a href="structCKIRV2Binding.html#a0e50855a2852b3018c3b87ae5e53db19">CKIRV2Binding::arg</a></div><div class="ttdeci">char * arg</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00036">ckernel_ir_v2.h:36</a></div></div>
<div class="ttc" id="astructCKIRV2Binding_html_acbaa32705fa3caa147f63c8beecd6fe5"><div class="ttname"><a href="structCKIRV2Binding.html#acbaa32705fa3caa147f63c8beecd6fe5">CKIRV2Binding::buffer</a></div><div class="ttdeci">int32_t buffer</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00037">ckernel_ir_v2.h:37</a></div></div>
<div class="ttc" id="astructCKIRV2Buffer_html"><div class="ttname"><a href="structCKIRV2Buffer.html">CKIRV2Buffer</a></div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00024">ckernel_ir_v2.h:24</a></div></div>
<div class="ttc" id="astructCKIRV2Buffer_html_a2f431336505aa19000ed2535be85bc71"><div class="ttname"><a href="structCKIRV2Buffer.html#a2f431336505aa19000ed2535be85bc71">CKIRV2Buffer::name</a></div><div class="ttdeci">char * name</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00025">ckernel_ir_v2.h:25</a></div></div>
<div class="ttc" id="astructCKIRV2Buffer_html_a50f6cc398851b0c231520444e855113b"><div class="ttname"><a href="structCKIRV2Buffer.html#a50f6cc398851b0c231520444e855113b">CKIRV2Buffer::condition</a></div><div class="ttdeci">char * condition</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00032">ckernel_ir_v2.h:32</a></div></div>
<div class="ttc" id="astructCKIRV2Graph_html_a49f1785b410e7bcae526d0b1dec440f3"><div class="ttname"><a href="structCKIRV2Graph.html#a49f1785b410e7bcae526d0b1dec440f3">CKIRV2Graph::config</a></div><div class="ttdeci">CKModelConfig config</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00056">ckernel_ir_v2.h:56</a></div></div>
<div class="ttc" id="astructCKIRV2Graph_html_a82745ad41882ae6c770f18a7759b23f6"><div class="ttname"><a href="structCKIRV2Graph.html#a82745ad41882ae6c770f18a7759b23f6">CKIRV2Graph::nodes</a></div><div class="ttdeci">CKIRV2Node * nodes</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00064">ckernel_ir_v2.h:64</a></div></div>
<div class="ttc" id="astructCKIRV2Graph_html_ae0b967575703465657a56a64d12164ed"><div class="ttname"><a href="structCKIRV2Graph.html#ae0b967575703465657a56a64d12164ed">CKIRV2Graph::num_nodes</a></div><div class="ttdeci">int num_nodes</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00063">ckernel_ir_v2.h:63</a></div></div>
<div class="ttc" id="astructCKIRV2Graph_html_aeb72a3027aef579daf9a4ac090ac71ba"><div class="ttname"><a href="structCKIRV2Graph.html#aeb72a3027aef579daf9a4ac090ac71ba">CKIRV2Graph::num_buffers</a></div><div class="ttdeci">int num_buffers</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00061">ckernel_ir_v2.h:61</a></div></div>
<div class="ttc" id="astructCKIRV2Node_html"><div class="ttname"><a href="structCKIRV2Node.html">CKIRV2Node</a></div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00040">ckernel_ir_v2.h:40</a></div></div>
<div class="ttc" id="astructCKIRV2Node_html_a47c09e1e5f659536f5ae6f0abb4b061a"><div class="ttname"><a href="structCKIRV2Node.html#a47c09e1e5f659536f5ae6f0abb4b061a">CKIRV2Node::n_bindings</a></div><div class="ttdeci">uint8_t n_bindings</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00048">ckernel_ir_v2.h:48</a></div></div>
<div class="ttc" id="astructCKIRV2Node_html_a4b5b83070cfaad5ecc383e411decd713"><div class="ttname"><a href="structCKIRV2Node.html#a4b5b83070cfaad5ecc383e411decd713">CKIRV2Node::op</a></div><div class="ttdeci">char * op</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00041">ckernel_ir_v2.h:41</a></div></div>
<div class="ttc" id="astructCKIRV2Node_html_a719657d39bb8a3107906b072969e77f9"><div class="ttname"><a href="structCKIRV2Node.html#a719657d39bb8a3107906b072969e77f9">CKIRV2Node::condition</a></div><div class="ttdeci">char * condition</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00044">ckernel_ir_v2.h:44</a></div></div>
<div class="ttc" id="astructCKIRV2Node_html_a830105276be359268bb949e27e406ae7"><div class="ttname"><a href="structCKIRV2Node.html#a830105276be359268bb949e27e406ae7">CKIRV2Node::layer</a></div><div class="ttdeci">uint16_t layer</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00045">ckernel_ir_v2.h:45</a></div></div>
<div class="ttc" id="astructCKIRV2Node_html_a8888fb53fa56aeaa19e4e0af16c30667"><div class="ttname"><a href="structCKIRV2Node.html#a8888fb53fa56aeaa19e4e0af16c30667">CKIRV2Node::flags</a></div><div class="ttdeci">uint8_t flags</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00046">ckernel_ir_v2.h:46</a></div></div>
<div class="ttc" id="astructCKIRV2Node_html_a8c7183052806860180f236095880ec04"><div class="ttname"><a href="structCKIRV2Node.html#a8c7183052806860180f236095880ec04">CKIRV2Node::bindings</a></div><div class="ttdeci">CKIRV2Binding bindings[24]</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00047">ckernel_ir_v2.h:47</a></div></div>
<div class="ttc" id="astructCKIRV2Node_html_abd1f5cc6077e8a035d8a2f0d69d30a48"><div class="ttname"><a href="structCKIRV2Node.html#abd1f5cc6077e8a035d8a2f0d69d30a48">CKIRV2Node::kernel_dtype</a></div><div class="ttdeci">CKDataType kernel_dtype</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00043">ckernel_ir_v2.h:43</a></div></div>
<div class="ttc" id="astructCKIRV2Node_html_ad351fdec7e39e8af9d29b729f8c0196b"><div class="ttname"><a href="structCKIRV2Node.html#ad351fdec7e39e8af9d29b729f8c0196b">CKIRV2Node::n_outputs</a></div><div class="ttdeci">uint8_t n_outputs</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00052">ckernel_ir_v2.h:52</a></div></div>
<div class="ttc" id="astructCKIRV2Node_html_ae7e891c0c72b3a0c726e416696299de9"><div class="ttname"><a href="structCKIRV2Node.html#ae7e891c0c72b3a0c726e416696299de9">CKIRV2Node::kernel</a></div><div class="ttdeci">char * kernel</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00042">ckernel_ir_v2.h:42</a></div></div>
<div class="ttc" id="astructCKIRV2Node_html_aef9c006f01df1247d1858ab622791f0a"><div class="ttname"><a href="structCKIRV2Node.html#aef9c006f01df1247d1858ab622791f0a">CKIRV2Node::n_inputs</a></div><div class="ttdeci">uint8_t n_inputs</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00050">ckernel_ir_v2.h:50</a></div></div>
<div class="ttc" id="astructCKKernelSpec_html"><div class="ttname"><a href="structCKKernelSpec.html">CKKernelSpec</a></div><div class="ttdef"><b>Definition:</b> <a href="ckernel__kernel__specs_8h_source.html#l00056">ckernel_kernel_specs.h:56</a></div></div>
<div class="ttc" id="astructCKKernelSpec_html_a851ca16066a7dfa2499bee69cfef2360"><div class="ttname"><a href="structCKKernelSpec.html#a851ca16066a7dfa2499bee69cfef2360">CKKernelSpec::default_dtype</a></div><div class="ttdeci">CKDataType default_dtype</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__kernel__specs_8h_source.html#l00061">ckernel_kernel_specs.h:61</a></div></div>
<div class="ttc" id="astructCKModelConfig_html_a01453afe2f69986d9ca04a10f7b9d0a4"><div class="ttname"><a href="structCKModelConfig.html#a01453afe2f69986d9ca04a10f7b9d0a4">CKModelConfig::num_layers</a></div><div class="ttdeci">int num_layers</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir_8h_source.html#l00024">ckernel_ir.h:24</a></div></div>
<div class="ttc" id="astructCKPlanBinding_html"><div class="ttname"><a href="structCKPlanBinding.html">CKPlanBinding</a></div><div class="ttdef"><b>Definition:</b> <a href="ckernel__kernel__specs_8h_source.html#l00070">ckernel_kernel_specs.h:70</a></div></div>
<div class="ttc" id="astructCKPlanBinding_html_a86cd6b157f1489dc20f7558c5a69c94f"><div class="ttname"><a href="structCKPlanBinding.html#a86cd6b157f1489dc20f7558c5a69c94f">CKPlanBinding::buffer</a></div><div class="ttdeci">const char * buffer</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__kernel__specs_8h_source.html#l00072">ckernel_kernel_specs.h:72</a></div></div>
<div class="ttc" id="astructCKPlanBinding_html_adf2dd85574e578a94cd1fc656d077505"><div class="ttname"><a href="structCKPlanBinding.html#adf2dd85574e578a94cd1fc656d077505">CKPlanBinding::arg</a></div><div class="ttdeci">const char * arg</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__kernel__specs_8h_source.html#l00071">ckernel_kernel_specs.h:71</a></div></div>
<div class="ttc" id="astructCKPlanStepV2_html"><div class="ttname"><a href="structCKPlanStepV2.html">CKPlanStepV2</a></div><div class="ttdef"><b>Definition:</b> <a href="ckernel__kernel__specs_8h_source.html#l00075">ckernel_kernel_specs.h:75</a></div></div>
<div class="ttc" id="astructCKPlanStepV2_html_a1762220af86b81c437f4290195e928b1"><div class="ttname"><a href="structCKPlanStepV2.html#a1762220af86b81c437f4290195e928b1">CKPlanStepV2::kernel</a></div><div class="ttdeci">const char * kernel</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__kernel__specs_8h_source.html#l00076">ckernel_kernel_specs.h:76</a></div></div>
<div class="ttc" id="astructCKPlanStepV2_html_a22d5d759ab81944a97689a1a80456664"><div class="ttname"><a href="structCKPlanStepV2.html#a22d5d759ab81944a97689a1a80456664">CKPlanStepV2::condition</a></div><div class="ttdeci">const char * condition</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__kernel__specs_8h_source.html#l00077">ckernel_kernel_specs.h:77</a></div></div>
<div class="ttc" id="astructCKPlanStepV2_html_a99fd1a750634dd8160937d173e7acf31"><div class="ttname"><a href="structCKPlanStepV2.html#a99fd1a750634dd8160937d173e7acf31">CKPlanStepV2::num_bindings</a></div><div class="ttdeci">size_t num_bindings</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__kernel__specs_8h_source.html#l00079">ckernel_kernel_specs.h:79</a></div></div>
<div class="ttc" id="astructCKPlanStepV2_html_acaaa916701cbcf1e9a5d35ff79e7c5bf"><div class="ttname"><a href="structCKPlanStepV2.html#acaaa916701cbcf1e9a5d35ff79e7c5bf">CKPlanStepV2::bindings</a></div><div class="ttdeci">const CKPlanBinding * bindings</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__kernel__specs_8h_source.html#l00078">ckernel_kernel_specs.h:78</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ckernel__ir__v2_8h_source.html#l00036">CKIRV2Binding::arg</a>, <a class="el" href="ckernel__kernel__specs_8h_source.html#l00071">CKPlanBinding::arg</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00047">CKIRV2Node::bindings</a>, <a class="el" href="ckernel__kernel__specs_8h_source.html#l00078">CKPlanStepV2::bindings</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00037">CKIRV2Binding::buffer</a>, <a class="el" href="ckernel__kernel__specs_8h_source.html#l00072">CKPlanBinding::buffer</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00062">CKIRV2Graph::buffers</a>, <a class="el" href="ckernel__kernel__specs_8c_source.html#l00083">ck_decoder_buffer_count</a>, <a class="el" href="ckernel__kernel__specs_8c_source.html#l00003">ck_decoder_buffers</a>, <a class="el" href="ckernel__kernel__specs_8c_source.html#l00313">ck_decoder_forward_plan_v2</a>, <a class="el" href="ckernel__kernel__specs_8c_source.html#l00327">ck_decoder_forward_plan_v2_count</a>, <a class="el" href="ckernel__dtype_8h_source.html#l00027">CK_DT_FP32</a>, <a class="el" href="ckernel__ir__v2__builder_8c_source.html#l00027">ck_ir_v2_copy_buffer_spec()</a>, <a class="el" href="ckernel__ir__v2__builder_8c_source.html#l00044">ck_ir_v2_find_buffer_index()</a>, <a class="el" href="ckernel__ir__v2__builder_8c_source.html#l00057">ck_ir_v2_find_kernel_spec()</a>, <a class="el" href="ckernel__ir__v2_8c_source.html#l00034">ck_ir_v2_free()</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00016">CK_IR_V2_MAX_BINDINGS</a>, <a class="el" href="ckernel__ir__v2__builder_8c_source.html#l00070">ck_ir_v2_select_kernel()</a>, <a class="el" href="ckernel__ir__v2__builder_8c_source.html#l00008">ck_ir_v2_strdup()</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00032">CKIRV2Buffer::condition</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00044">CKIRV2Node::condition</a>, <a class="el" href="ckernel__kernel__specs_8h_source.html#l00077">CKPlanStepV2::condition</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00056">CKIRV2Graph::config</a>, <a class="el" href="ckernel__kernel__specs_8h_source.html#l00061">CKKernelSpec::default_dtype</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00046">CKIRV2Node::flags</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00059">CKIRV2Graph::fused_qkv</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00060">CKIRV2Graph::gated_mlp</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00057">CKIRV2Graph::has_pos_emb</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00042">CKIRV2Node::kernel</a>, <a class="el" href="ckernel__kernel__specs_8h_source.html#l00076">CKPlanStepV2::kernel</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00043">CKIRV2Node::kernel_dtype</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00045">CKIRV2Node::layer</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00048">CKIRV2Node::n_bindings</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00050">CKIRV2Node::n_inputs</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00052">CKIRV2Node::n_outputs</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00025">CKIRV2Buffer::name</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00064">CKIRV2Graph::nodes</a>, <a class="el" href="ckernel__kernel__specs_8h_source.html#l00079">CKPlanStepV2::num_bindings</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00061">CKIRV2Graph::num_buffers</a>, <a class="el" href="ckernel__ir_8h_source.html#l00024">CKModelConfig::num_layers</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00063">CKIRV2Graph::num_nodes</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00041">CKIRV2Node::op</a>, and <a class="el" href="ckernel__ir__v2_8h_source.html#l00058">CKIRV2Graph::tie_word_embeddings</a>.</p>

<p class="reference">Referenced by <a class="el" href="ckernel__ir__v2__demo_8c_source.html#l00025">main()</a>.</p>

</div>
</div>
<a id="ad34447264bfb018e6d5f856c5fcff1f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad34447264bfb018e6d5f856c5fcff1f3">&#9670;&nbsp;</a></span>ck_ir_v2_build_decoder_backward()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ck_ir_v2_build_decoder_backward </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structCKIRV2Graph.html">CKIRV2Graph</a> *&#160;</td>
          <td class="paramname"><em>forward</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structCKIRV2Graph.html">CKIRV2Graph</a> *&#160;</td>
          <td class="paramname"><em>backward</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ckernel__ir__v2__builder_8c_source.html#l00356">356</a> of file <a class="el" href="ckernel__ir__v2__builder_8c_source.html">ckernel_ir_v2_builder.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;{</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keywordflow">if</span> (!forward || !backward) {</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    }</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    memset(backward, 0, <span class="keyword">sizeof</span>(*backward));</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    backward-&gt;<a class="code" href="structCKIRV2Graph.html#a49f1785b410e7bcae526d0b1dec440f3">config</a> = forward-&gt;<a class="code" href="structCKIRV2Graph.html#a49f1785b410e7bcae526d0b1dec440f3">config</a>;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160; </div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    backward-&gt;<a class="code" href="structCKIRV2Graph.html#aeb72a3027aef579daf9a4ac090ac71ba">num_buffers</a> = forward-&gt;<a class="code" href="structCKIRV2Graph.html#aeb72a3027aef579daf9a4ac090ac71ba">num_buffers</a>;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    backward-&gt;<a class="code" href="structCKIRV2Graph.html#ad2d61568dda8232b3252da14a53ffc03">buffers</a> = (<a class="code" href="structCKIRV2Buffer.html">CKIRV2Buffer</a> *)calloc((<span class="keywordtype">size_t</span>)backward-&gt;<a class="code" href="structCKIRV2Graph.html#aeb72a3027aef579daf9a4ac090ac71ba">num_buffers</a>, <span class="keyword">sizeof</span>(<a class="code" href="structCKIRV2Buffer.html">CKIRV2Buffer</a>));</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordflow">if</span> (!backward-&gt;<a class="code" href="structCKIRV2Graph.html#ad2d61568dda8232b3252da14a53ffc03">buffers</a>) {</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    }</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; backward-&gt;<a class="code" href="structCKIRV2Graph.html#aeb72a3027aef579daf9a4ac090ac71ba">num_buffers</a>; ++i) {</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <a class="code" href="structCKBufferSpec.html">CKBufferSpec</a> spec = {0};</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        <span class="keyword">const</span> <a class="code" href="structCKIRV2Buffer.html">CKIRV2Buffer</a> *src = &amp;forward-&gt;<a class="code" href="structCKIRV2Graph.html#ad2d61568dda8232b3252da14a53ffc03">buffers</a>[i];</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        spec.<a class="code" href="structCKBufferSpec.html#a92c6aec4e6937bbec34f20ddc341b14c">name</a> = src-&gt;<a class="code" href="structCKIRV2Buffer.html#a2f431336505aa19000ed2535be85bc71">name</a>;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        spec.<a class="code" href="structCKBufferSpec.html#a81f2619d250bfb5c7401070c0345353a">scope</a> = src-&gt;<a class="code" href="structCKIRV2Buffer.html#a65ba8945f7e4e11abf1cc3aad4eccb60">scope</a>;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        spec.<a class="code" href="structCKBufferSpec.html#a313cd889d11375cfaf4db616ed1c99ac">role</a> = src-&gt;<a class="code" href="structCKIRV2Buffer.html#a3c077f1f0bdfd4b832a17aea56c823d1">role</a>;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        spec.<a class="code" href="structCKBufferSpec.html#a2b1e3d9cac9dfffef27a598dc88207c9">dtype</a> = src-&gt;<a class="code" href="structCKIRV2Buffer.html#acb1dc8a19c8fad476e89ab40bd6d31bf">dtype</a>;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        spec.<a class="code" href="structCKBufferSpec.html#a557043a61f56575dfa44c4f13b31cddb">optional</a> = src-&gt;<a class="code" href="structCKIRV2Buffer.html#a3b28242247696e6624bb2b9773c1e1a1">optional</a>;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        spec.<a class="code" href="structCKBufferSpec.html#a3d2e80ce499f08ea3e9d969de367f945">alias_of</a> = src-&gt;<a class="code" href="structCKIRV2Buffer.html#a92f6356a2149550923b521d604bc9486">alias_of</a>;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        spec.<a class="code" href="structCKBufferSpec.html#a4af21c5671866d5883b7c95cd9032afd">condition</a> = src-&gt;<a class="code" href="structCKIRV2Buffer.html#a50f6cc398851b0c231520444e855113b">condition</a>;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        memcpy(spec.<a class="code" href="structCKBufferSpec.html#ae34b00c892e6e3ffd7928a0a31924b59">shape</a>, src-&gt;<a class="code" href="structCKIRV2Buffer.html#a22f159608ef2fbcdfdd84704ae3f5da4">shape</a>, <span class="keyword">sizeof</span>(spec.<a class="code" href="structCKBufferSpec.html#ae34b00c892e6e3ffd7928a0a31924b59">shape</a>));</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="ckernel__ir__v2__builder_8c.html#a29e53bd4efe76f71f9f493bd6ca03364">ck_ir_v2_copy_buffer_spec</a>(&amp;spec, &amp;backward-&gt;<a class="code" href="structCKIRV2Graph.html#ad2d61568dda8232b3252da14a53ffc03">buffers</a>[i]) != 0) {</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            <a class="code" href="ckernel__ir__v2_8h.html#a681eb8d191d9589d6ff0ecb59536c671">ck_ir_v2_free</a>(backward);</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        }</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    }</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160; </div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="keywordtype">int</span> plan_count = (int)<a class="code" href="ckernel__kernel__specs_8h.html#a78253557cd8c8795464f1988cd7c23a5">ck_decoder_backward_plan_v2_count</a>;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    backward-&gt;<a class="code" href="structCKIRV2Graph.html#ae0b967575703465657a56a64d12164ed">num_nodes</a> = forward-&gt;<a class="code" href="structCKIRV2Graph.html#a49f1785b410e7bcae526d0b1dec440f3">config</a>.<a class="code" href="structCKModelConfig.html#a01453afe2f69986d9ca04a10f7b9d0a4">num_layers</a> * plan_count;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    backward-&gt;<a class="code" href="structCKIRV2Graph.html#a82745ad41882ae6c770f18a7759b23f6">nodes</a> = (<a class="code" href="structCKIRV2Node.html">CKIRV2Node</a> *)calloc((<span class="keywordtype">size_t</span>)backward-&gt;<a class="code" href="structCKIRV2Graph.html#ae0b967575703465657a56a64d12164ed">num_nodes</a>, <span class="keyword">sizeof</span>(<a class="code" href="structCKIRV2Node.html">CKIRV2Node</a>));</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <span class="keywordflow">if</span> (!backward-&gt;<a class="code" href="structCKIRV2Graph.html#a82745ad41882ae6c770f18a7759b23f6">nodes</a>) {</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <a class="code" href="ckernel__ir__v2_8h.html#a681eb8d191d9589d6ff0ecb59536c671">ck_ir_v2_free</a>(backward);</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    }</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160; </div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <span class="keywordtype">int</span> idx = 0;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> layer = 0; layer &lt; forward-&gt;<a class="code" href="structCKIRV2Graph.html#a49f1785b410e7bcae526d0b1dec440f3">config</a>.<a class="code" href="structCKModelConfig.html#a01453afe2f69986d9ca04a10f7b9d0a4">num_layers</a>; ++layer) {</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> p = 0; p &lt; plan_count; ++p) {</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;            <span class="keyword">const</span> <a class="code" href="structCKPlanStepV2.html">CKPlanStepV2</a> *step = &amp;<a class="code" href="ckernel__kernel__specs_8h.html#ac454d061133c2eff4e5084be4ebacb00">ck_decoder_backward_plan_v2</a>[p];</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            <span class="keyword">const</span> <a class="code" href="structCKKernelSpec.html">CKKernelSpec</a> *spec = <a class="code" href="ckernel__ir__v2__builder_8c.html#af49195eecf6a337b1d16a56ed0e37922">ck_ir_v2_find_kernel_spec</a>(step-&gt;<a class="code" href="structCKPlanStepV2.html#a1762220af86b81c437f4290195e928b1">kernel</a>);</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            <a class="code" href="ckernel__dtype_8h.html#a9d2373b6c685cf9421a6fb638964aa65">CKDataType</a> dtype = spec ? spec-&gt;<a class="code" href="structCKKernelSpec.html#a851ca16066a7dfa2499bee69cfef2360">default_dtype</a> : <a class="code" href="ckernel__dtype_8h.html#a9d2373b6c685cf9421a6fb638964aa65a9b7d39257d8dd8044a4012bc6db08e2b">CK_DT_FP32</a>;</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">char</span> *impl = <a class="code" href="ckernel__ir__v2__builder_8c.html#a2a289dfc861e40f2cc178fd95b37b0e5">ck_ir_v2_select_kernel</a>(spec, dtype, 1);</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            <a class="code" href="structCKIRV2Node.html">CKIRV2Node</a> *node = &amp;backward-&gt;<a class="code" href="structCKIRV2Graph.html#a82745ad41882ae6c770f18a7759b23f6">nodes</a>[idx++];</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            node-&gt;<a class="code" href="structCKIRV2Node.html#a830105276be359268bb949e27e406ae7">layer</a> = (uint16_t)layer;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            node-&gt;<a class="code" href="structCKIRV2Node.html#a4b5b83070cfaad5ecc383e411decd713">op</a> = <a class="code" href="ckernel__ir__v2__builder_8c.html#a104bb744263fc943e02e9fb5e66632bf">ck_ir_v2_strdup</a>(step-&gt;<a class="code" href="structCKPlanStepV2.html#a1762220af86b81c437f4290195e928b1">kernel</a>);</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            node-&gt;<a class="code" href="structCKIRV2Node.html#ae7e891c0c72b3a0c726e416696299de9">kernel</a> = <a class="code" href="ckernel__ir__v2__builder_8c.html#a104bb744263fc943e02e9fb5e66632bf">ck_ir_v2_strdup</a>(impl ? impl : step-&gt;<a class="code" href="structCKPlanStepV2.html#a1762220af86b81c437f4290195e928b1">kernel</a>);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            node-&gt;<a class="code" href="structCKIRV2Node.html#abd1f5cc6077e8a035d8a2f0d69d30a48">kernel_dtype</a> = dtype;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            node-&gt;<a class="code" href="structCKIRV2Node.html#a719657d39bb8a3107906b072969e77f9">condition</a> = <a class="code" href="ckernel__ir__v2__builder_8c.html#a104bb744263fc943e02e9fb5e66632bf">ck_ir_v2_strdup</a>(step-&gt;<a class="code" href="structCKPlanStepV2.html#a22d5d759ab81944a97689a1a80456664">condition</a>);</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;            node-&gt;<a class="code" href="structCKIRV2Node.html#a8888fb53fa56aeaa19e4e0af16c30667">flags</a> = 0;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            node-&gt;<a class="code" href="structCKIRV2Node.html#a47c09e1e5f659536f5ae6f0abb4b061a">n_bindings</a> = 0;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;            <span class="keywordflow">if</span> (step-&gt;<a class="code" href="structCKPlanStepV2.html#acaaa916701cbcf1e9a5d35ff79e7c5bf">bindings</a> &amp;&amp; step-&gt;<a class="code" href="structCKPlanStepV2.html#a99fd1a750634dd8160937d173e7acf31">num_bindings</a> &gt; 0) {</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                <span class="keywordtype">int</span> limit = (int)step-&gt;<a class="code" href="structCKPlanStepV2.html#a99fd1a750634dd8160937d173e7acf31">num_bindings</a>;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                if (limit &gt; <a class="code" href="ckernel__ir__v2_8h.html#a0ee7790c95183c6bfb4e941096fab601">CK_IR_V2_MAX_BINDINGS</a>) {</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                    limit = <a class="code" href="ckernel__ir__v2_8h.html#a0ee7790c95183c6bfb4e941096fab601">CK_IR_V2_MAX_BINDINGS</a>;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                }</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> b = 0; b &lt; limit; ++b) {</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                    <span class="keyword">const</span> <a class="code" href="structCKPlanBinding.html">CKPlanBinding</a> *binding = &amp;step-&gt;<a class="code" href="structCKPlanStepV2.html#acaaa916701cbcf1e9a5d35ff79e7c5bf">bindings</a>[b];</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                    node-&gt;<a class="code" href="structCKIRV2Node.html#a8c7183052806860180f236095880ec04">bindings</a>[node-&gt;<a class="code" href="structCKIRV2Node.html#a47c09e1e5f659536f5ae6f0abb4b061a">n_bindings</a>].<a class="code" href="structCKIRV2Binding.html#a0e50855a2852b3018c3b87ae5e53db19">arg</a> = <a class="code" href="ckernel__ir__v2__builder_8c.html#a104bb744263fc943e02e9fb5e66632bf">ck_ir_v2_strdup</a>(binding-&gt;<a class="code" href="structCKPlanBinding.html#adf2dd85574e578a94cd1fc656d077505">arg</a>);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                    node-&gt;<a class="code" href="structCKIRV2Node.html#a8c7183052806860180f236095880ec04">bindings</a>[node-&gt;<a class="code" href="structCKIRV2Node.html#a47c09e1e5f659536f5ae6f0abb4b061a">n_bindings</a>].<a class="code" href="structCKIRV2Binding.html#acbaa32705fa3caa147f63c8beecd6fe5">buffer</a> =</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                        <a class="code" href="ckernel__ir__v2__builder_8c.html#ad0ca6b1fd812a332aa86eef694f67a8f">ck_ir_v2_find_buffer_index</a>(backward, binding-&gt;<a class="code" href="structCKPlanBinding.html#a86cd6b157f1489dc20f7558c5a69c94f">buffer</a>);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                    node-&gt;<a class="code" href="structCKIRV2Node.html#a47c09e1e5f659536f5ae6f0abb4b061a">n_bindings</a>++;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                }</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            }</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            node-&gt;<a class="code" href="structCKIRV2Node.html#aef9c006f01df1247d1858ab622791f0a">n_inputs</a> = 0;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            node-&gt;<a class="code" href="structCKIRV2Node.html#ad351fdec7e39e8af9d29b729f8c0196b">n_outputs</a> = 0;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;        }</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    }</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;}</div>
<div class="ttc" id="ackernel__kernel__specs_8h_html_a78253557cd8c8795464f1988cd7c23a5"><div class="ttname"><a href="ckernel__kernel__specs_8h.html#a78253557cd8c8795464f1988cd7c23a5">ck_decoder_backward_plan_v2_count</a></div><div class="ttdeci">const size_t ck_decoder_backward_plan_v2_count</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__kernel__specs_8c_source.html#l00343">ckernel_kernel_specs.c:343</a></div></div>
<div class="ttc" id="ackernel__kernel__specs_8h_html_ac454d061133c2eff4e5084be4ebacb00"><div class="ttname"><a href="ckernel__kernel__specs_8h.html#ac454d061133c2eff4e5084be4ebacb00">ck_decoder_backward_plan_v2</a></div><div class="ttdeci">const CKPlanStepV2 ck_decoder_backward_plan_v2[]</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__kernel__specs_8c_source.html#l00329">ckernel_kernel_specs.c:329</a></div></div>
<div class="ttc" id="astructCKBufferSpec_html"><div class="ttname"><a href="structCKBufferSpec.html">CKBufferSpec</a></div><div class="ttdef"><b>Definition:</b> <a href="ckernel__kernel__specs_8h_source.html#l00045">ckernel_kernel_specs.h:45</a></div></div>
<div class="ttc" id="astructCKBufferSpec_html_a2b1e3d9cac9dfffef27a598dc88207c9"><div class="ttname"><a href="structCKBufferSpec.html#a2b1e3d9cac9dfffef27a598dc88207c9">CKBufferSpec::dtype</a></div><div class="ttdeci">CKDataType dtype</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__kernel__specs_8h_source.html#l00053">ckernel_kernel_specs.h:53</a></div></div>
<div class="ttc" id="astructCKBufferSpec_html_a313cd889d11375cfaf4db616ed1c99ac"><div class="ttname"><a href="structCKBufferSpec.html#a313cd889d11375cfaf4db616ed1c99ac">CKBufferSpec::role</a></div><div class="ttdeci">CKBufferRole role</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__kernel__specs_8h_source.html#l00048">ckernel_kernel_specs.h:48</a></div></div>
<div class="ttc" id="astructCKBufferSpec_html_a3d2e80ce499f08ea3e9d969de367f945"><div class="ttname"><a href="structCKBufferSpec.html#a3d2e80ce499f08ea3e9d969de367f945">CKBufferSpec::alias_of</a></div><div class="ttdeci">const char * alias_of</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__kernel__specs_8h_source.html#l00051">ckernel_kernel_specs.h:51</a></div></div>
<div class="ttc" id="astructCKBufferSpec_html_a4af21c5671866d5883b7c95cd9032afd"><div class="ttname"><a href="structCKBufferSpec.html#a4af21c5671866d5883b7c95cd9032afd">CKBufferSpec::condition</a></div><div class="ttdeci">const char * condition</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__kernel__specs_8h_source.html#l00052">ckernel_kernel_specs.h:52</a></div></div>
<div class="ttc" id="astructCKBufferSpec_html_a557043a61f56575dfa44c4f13b31cddb"><div class="ttname"><a href="structCKBufferSpec.html#a557043a61f56575dfa44c4f13b31cddb">CKBufferSpec::optional</a></div><div class="ttdeci">int optional</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__kernel__specs_8h_source.html#l00050">ckernel_kernel_specs.h:50</a></div></div>
<div class="ttc" id="astructCKBufferSpec_html_a81f2619d250bfb5c7401070c0345353a"><div class="ttname"><a href="structCKBufferSpec.html#a81f2619d250bfb5c7401070c0345353a">CKBufferSpec::scope</a></div><div class="ttdeci">CKBufferScope scope</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__kernel__specs_8h_source.html#l00047">ckernel_kernel_specs.h:47</a></div></div>
<div class="ttc" id="astructCKBufferSpec_html_a92c6aec4e6937bbec34f20ddc341b14c"><div class="ttname"><a href="structCKBufferSpec.html#a92c6aec4e6937bbec34f20ddc341b14c">CKBufferSpec::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__kernel__specs_8h_source.html#l00046">ckernel_kernel_specs.h:46</a></div></div>
<div class="ttc" id="astructCKBufferSpec_html_ae34b00c892e6e3ffd7928a0a31924b59"><div class="ttname"><a href="structCKBufferSpec.html#ae34b00c892e6e3ffd7928a0a31924b59">CKBufferSpec::shape</a></div><div class="ttdeci">CKDimToken shape[4]</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__kernel__specs_8h_source.html#l00049">ckernel_kernel_specs.h:49</a></div></div>
<div class="ttc" id="astructCKIRV2Buffer_html_a22f159608ef2fbcdfdd84704ae3f5da4"><div class="ttname"><a href="structCKIRV2Buffer.html#a22f159608ef2fbcdfdd84704ae3f5da4">CKIRV2Buffer::shape</a></div><div class="ttdeci">CKDimToken shape[4]</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00029">ckernel_ir_v2.h:29</a></div></div>
<div class="ttc" id="astructCKIRV2Buffer_html_a3b28242247696e6624bb2b9773c1e1a1"><div class="ttname"><a href="structCKIRV2Buffer.html#a3b28242247696e6624bb2b9773c1e1a1">CKIRV2Buffer::optional</a></div><div class="ttdeci">int optional</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00030">ckernel_ir_v2.h:30</a></div></div>
<div class="ttc" id="astructCKIRV2Buffer_html_a3c077f1f0bdfd4b832a17aea56c823d1"><div class="ttname"><a href="structCKIRV2Buffer.html#a3c077f1f0bdfd4b832a17aea56c823d1">CKIRV2Buffer::role</a></div><div class="ttdeci">CKBufferRole role</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00027">ckernel_ir_v2.h:27</a></div></div>
<div class="ttc" id="astructCKIRV2Buffer_html_a65ba8945f7e4e11abf1cc3aad4eccb60"><div class="ttname"><a href="structCKIRV2Buffer.html#a65ba8945f7e4e11abf1cc3aad4eccb60">CKIRV2Buffer::scope</a></div><div class="ttdeci">CKBufferScope scope</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00026">ckernel_ir_v2.h:26</a></div></div>
<div class="ttc" id="astructCKIRV2Buffer_html_acb1dc8a19c8fad476e89ab40bd6d31bf"><div class="ttname"><a href="structCKIRV2Buffer.html#acb1dc8a19c8fad476e89ab40bd6d31bf">CKIRV2Buffer::dtype</a></div><div class="ttdeci">CKDataType dtype</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00028">ckernel_ir_v2.h:28</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ckernel__ir__v2_8h_source.html#l00031">CKIRV2Buffer::alias_of</a>, <a class="el" href="ckernel__kernel__specs_8h_source.html#l00051">CKBufferSpec::alias_of</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00036">CKIRV2Binding::arg</a>, <a class="el" href="ckernel__kernel__specs_8h_source.html#l00071">CKPlanBinding::arg</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00047">CKIRV2Node::bindings</a>, <a class="el" href="ckernel__kernel__specs_8h_source.html#l00078">CKPlanStepV2::bindings</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00037">CKIRV2Binding::buffer</a>, <a class="el" href="ckernel__kernel__specs_8h_source.html#l00072">CKPlanBinding::buffer</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00062">CKIRV2Graph::buffers</a>, <a class="el" href="ckernel__kernel__specs_8c_source.html#l00329">ck_decoder_backward_plan_v2</a>, <a class="el" href="ckernel__kernel__specs_8c_source.html#l00343">ck_decoder_backward_plan_v2_count</a>, <a class="el" href="ckernel__dtype_8h_source.html#l00027">CK_DT_FP32</a>, <a class="el" href="ckernel__ir__v2__builder_8c_source.html#l00027">ck_ir_v2_copy_buffer_spec()</a>, <a class="el" href="ckernel__ir__v2__builder_8c_source.html#l00044">ck_ir_v2_find_buffer_index()</a>, <a class="el" href="ckernel__ir__v2__builder_8c_source.html#l00057">ck_ir_v2_find_kernel_spec()</a>, <a class="el" href="ckernel__ir__v2_8c_source.html#l00034">ck_ir_v2_free()</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00016">CK_IR_V2_MAX_BINDINGS</a>, <a class="el" href="ckernel__ir__v2__builder_8c_source.html#l00070">ck_ir_v2_select_kernel()</a>, <a class="el" href="ckernel__ir__v2__builder_8c_source.html#l00008">ck_ir_v2_strdup()</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00032">CKIRV2Buffer::condition</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00044">CKIRV2Node::condition</a>, <a class="el" href="ckernel__kernel__specs_8h_source.html#l00052">CKBufferSpec::condition</a>, <a class="el" href="ckernel__kernel__specs_8h_source.html#l00077">CKPlanStepV2::condition</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00056">CKIRV2Graph::config</a>, <a class="el" href="ckernel__kernel__specs_8h_source.html#l00061">CKKernelSpec::default_dtype</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00028">CKIRV2Buffer::dtype</a>, <a class="el" href="ckernel__kernel__specs_8h_source.html#l00053">CKBufferSpec::dtype</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00046">CKIRV2Node::flags</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00042">CKIRV2Node::kernel</a>, <a class="el" href="ckernel__kernel__specs_8h_source.html#l00076">CKPlanStepV2::kernel</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00043">CKIRV2Node::kernel_dtype</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00045">CKIRV2Node::layer</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00048">CKIRV2Node::n_bindings</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00050">CKIRV2Node::n_inputs</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00052">CKIRV2Node::n_outputs</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00025">CKIRV2Buffer::name</a>, <a class="el" href="ckernel__kernel__specs_8h_source.html#l00046">CKBufferSpec::name</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00064">CKIRV2Graph::nodes</a>, <a class="el" href="ckernel__kernel__specs_8h_source.html#l00079">CKPlanStepV2::num_bindings</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00061">CKIRV2Graph::num_buffers</a>, <a class="el" href="ckernel__ir_8h_source.html#l00024">CKModelConfig::num_layers</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00063">CKIRV2Graph::num_nodes</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00041">CKIRV2Node::op</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00030">CKIRV2Buffer::optional</a>, <a class="el" href="ckernel__kernel__specs_8h_source.html#l00050">CKBufferSpec::optional</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00027">CKIRV2Buffer::role</a>, <a class="el" href="ckernel__kernel__specs_8h_source.html#l00048">CKBufferSpec::role</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00026">CKIRV2Buffer::scope</a>, <a class="el" href="ckernel__kernel__specs_8h_source.html#l00047">CKBufferSpec::scope</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00029">CKIRV2Buffer::shape</a>, and <a class="el" href="ckernel__kernel__specs_8h_source.html#l00049">CKBufferSpec::shape</a>.</p>

<p class="reference">Referenced by <a class="el" href="ckernel__ir__v2__demo_8c_source.html#l00025">main()</a>.</p>

</div>
</div>
<a id="a681eb8d191d9589d6ff0ecb59536c671"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a681eb8d191d9589d6ff0ecb59536c671">&#9670;&nbsp;</a></span>ck_ir_v2_free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ck_ir_v2_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structCKIRV2Graph.html">CKIRV2Graph</a> *&#160;</td>
          <td class="paramname"><em>graph</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ckernel__ir__v2_8c_source.html#l00034">34</a> of file <a class="el" href="ckernel__ir__v2_8c_source.html">ckernel_ir_v2.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;{</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keywordflow">if</span> (!graph) {</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    }</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keywordflow">if</span> (graph-&gt;<a class="code" href="structCKIRV2Graph.html#ad2d61568dda8232b3252da14a53ffc03">buffers</a>) {</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; graph-&gt;<a class="code" href="structCKIRV2Graph.html#aeb72a3027aef579daf9a4ac090ac71ba">num_buffers</a>; ++i) {</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;            <a class="code" href="ckernel__ir__v2_8c.html#a2d4b092eeda3d5fd6f4827738c392cf0">ck_ir_v2_free_buffer</a>(&amp;graph-&gt;<a class="code" href="structCKIRV2Graph.html#ad2d61568dda8232b3252da14a53ffc03">buffers</a>[i]);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        }</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        free(graph-&gt;<a class="code" href="structCKIRV2Graph.html#ad2d61568dda8232b3252da14a53ffc03">buffers</a>);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    }</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keywordflow">if</span> (graph-&gt;<a class="code" href="structCKIRV2Graph.html#a82745ad41882ae6c770f18a7759b23f6">nodes</a>) {</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; graph-&gt;<a class="code" href="structCKIRV2Graph.html#ae0b967575703465657a56a64d12164ed">num_nodes</a>; ++i) {</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;            <a class="code" href="ckernel__ir__v2_8c.html#a2991dcb555833cd8219bb72c0bb1365e">ck_ir_v2_free_node</a>(&amp;graph-&gt;<a class="code" href="structCKIRV2Graph.html#a82745ad41882ae6c770f18a7759b23f6">nodes</a>[i]);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        }</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        free(graph-&gt;<a class="code" href="structCKIRV2Graph.html#a82745ad41882ae6c770f18a7759b23f6">nodes</a>);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    }</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    memset(graph, 0, <span class="keyword">sizeof</span>(*graph));</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;}</div>
<div class="ttc" id="ackernel__ir__v2_8c_html_a2991dcb555833cd8219bb72c0bb1365e"><div class="ttname"><a href="ckernel__ir__v2_8c.html#a2991dcb555833cd8219bb72c0bb1365e">ck_ir_v2_free_node</a></div><div class="ttdeci">static void ck_ir_v2_free_node(CKIRV2Node *node)</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8c_source.html#l00020">ckernel_ir_v2.c:20</a></div></div>
<div class="ttc" id="ackernel__ir__v2_8c_html_a2d4b092eeda3d5fd6f4827738c392cf0"><div class="ttname"><a href="ckernel__ir__v2_8c.html#a2d4b092eeda3d5fd6f4827738c392cf0">ck_ir_v2_free_buffer</a></div><div class="ttdeci">static void ck_ir_v2_free_buffer(CKIRV2Buffer *buf)</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8c_source.html#l00009">ckernel_ir_v2.c:9</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ckernel__ir__v2_8h_source.html#l00062">CKIRV2Graph::buffers</a>, <a class="el" href="ckernel__ir__v2_8c_source.html#l00009">ck_ir_v2_free_buffer()</a>, <a class="el" href="ckernel__ir__v2_8c_source.html#l00020">ck_ir_v2_free_node()</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00064">CKIRV2Graph::nodes</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00061">CKIRV2Graph::num_buffers</a>, and <a class="el" href="ckernel__ir__v2_8h_source.html#l00063">CKIRV2Graph::num_nodes</a>.</p>

<p class="reference">Referenced by <a class="el" href="ckernel__ir__v2__builder_8c_source.html#l00285">ck_ir_v2_build_decoder()</a>, <a class="el" href="ckernel__ir__v2__builder_8c_source.html#l00356">ck_ir_v2_build_decoder_backward()</a>, <a class="el" href="ckernel__ir__v2__lower_8c_source.html#l00219">ck_ir_v2_lower_emit_json()</a>, <a class="el" href="ckernel__ir__v2__lower_8c_source.html#l00177">ck_ir_v2_lower_graph()</a>, <a class="el" href="ckernel__ir__v2_8c_source.html#l01100">ck_ir_v2_parse_json()</a>, and <a class="el" href="ckernel__ir__v2__demo_8c_source.html#l00025">main()</a>.</p>

</div>
</div>
<a id="a823b147ca06c5f9073e6eaedff358bb1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a823b147ca06c5f9073e6eaedff358bb1">&#9670;&nbsp;</a></span>ck_ir_v2_parse_json()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ck_ir_v2_parse_json </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structCKIRV2Graph.html">CKIRV2Graph</a> *&#160;</td>
          <td class="paramname"><em>graph</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ckernel__ir__v2_8c_source.html#l01100">1100</a> of file <a class="el" href="ckernel__ir__v2_8c_source.html">ckernel_ir_v2.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;{</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    <span class="keywordflow">if</span> (!path || !graph) {</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    }</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    FILE *f = fopen(path, <span class="stringliteral">&quot;rb&quot;</span>);</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    <span class="keywordflow">if</span> (!f) {</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;        perror(<span class="stringliteral">&quot;ck_ir_v2_parse_json: fopen&quot;</span>);</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;    }</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    <span class="keywordflow">if</span> (fseek(f, 0, SEEK_END) != 0) {</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        fclose(f);</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    }</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    <span class="keywordtype">long</span> len = ftell(f);</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    <span class="keywordflow">if</span> (len &lt; 0) {</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;        fclose(f);</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    }</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    <span class="keywordflow">if</span> (fseek(f, 0, SEEK_SET) != 0) {</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;        fclose(f);</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    }</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;    <span class="keywordtype">char</span> *buf = (<span class="keywordtype">char</span> *)malloc((<span class="keywordtype">size_t</span>)len + 1);</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    <span class="keywordflow">if</span> (!buf) {</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;        fclose(f);</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    }</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    <span class="keywordtype">size_t</span> nread = fread(buf, 1, (<span class="keywordtype">size_t</span>)len, f);</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    fclose(f);</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    buf[nread] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160; </div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    <a class="code" href="structCKIRV2Graph.html">CKIRV2Graph</a> tmp = {0};</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *end = buf + nread;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160; </div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    tmp.<a class="code" href="structCKIRV2Graph.html#a520e755b859ef64a2f7299c9472e9911">has_pos_emb</a> = 1;</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    tmp.<a class="code" href="structCKIRV2Graph.html#a5296e6ba849fa74670cf9290065ac2c9">tie_word_embeddings</a> = -1;</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    tmp.<a class="code" href="structCKIRV2Graph.html#adfc2e02d30a154499cfa803b1095dc6a">fused_qkv</a> = -1;</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    tmp.<a class="code" href="structCKIRV2Graph.html#a6e330ed95df881c765d7fbb5f5c62d35">gated_mlp</a> = -1;</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160; </div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ckernel__ir__v2_8c.html#aa8d3d9a24512a941039e8a3db6674e79">ck_ir_v2_parse_int</a>(buf, <span class="stringliteral">&quot;\&quot;num_layers\&quot;&quot;</span>, end, &amp;tmp.<a class="code" href="structCKIRV2Graph.html#a49f1785b410e7bcae526d0b1dec440f3">config</a>.<a class="code" href="structCKModelConfig.html#a01453afe2f69986d9ca04a10f7b9d0a4">num_layers</a>) != 0 ||</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;        <a class="code" href="ckernel__ir__v2_8c.html#aa8d3d9a24512a941039e8a3db6674e79">ck_ir_v2_parse_int</a>(buf, <span class="stringliteral">&quot;\&quot;hidden_size\&quot;&quot;</span>, end, &amp;tmp.<a class="code" href="structCKIRV2Graph.html#a49f1785b410e7bcae526d0b1dec440f3">config</a>.<a class="code" href="structCKModelConfig.html#afd04ffe4db48600b90f32904c49d73af">hidden_size</a>) != 0 ||</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;        <a class="code" href="ckernel__ir__v2_8c.html#aa8d3d9a24512a941039e8a3db6674e79">ck_ir_v2_parse_int</a>(buf, <span class="stringliteral">&quot;\&quot;intermediate_size\&quot;&quot;</span>, end, &amp;tmp.<a class="code" href="structCKIRV2Graph.html#a49f1785b410e7bcae526d0b1dec440f3">config</a>.<a class="code" href="structCKModelConfig.html#a2da9b0b988ccf3b7117a611da5984d34">intermediate_size</a>) != 0 ||</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;        <a class="code" href="ckernel__ir__v2_8c.html#aa8d3d9a24512a941039e8a3db6674e79">ck_ir_v2_parse_int</a>(buf, <span class="stringliteral">&quot;\&quot;num_attention_heads\&quot;&quot;</span>, end, &amp;tmp.<a class="code" href="structCKIRV2Graph.html#a49f1785b410e7bcae526d0b1dec440f3">config</a>.<a class="code" href="structCKModelConfig.html#a3e5c8e6d2da07805365ec6b4db29b9ea">num_heads</a>) != 0 ||</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;        <a class="code" href="ckernel__ir__v2_8c.html#aa8d3d9a24512a941039e8a3db6674e79">ck_ir_v2_parse_int</a>(buf, <span class="stringliteral">&quot;\&quot;num_kv_heads\&quot;&quot;</span>, end, &amp;tmp.<a class="code" href="structCKIRV2Graph.html#a49f1785b410e7bcae526d0b1dec440f3">config</a>.<a class="code" href="structCKModelConfig.html#a902b19335449fa61c1e532d9999aa342">num_kv_heads</a>) != 0) {</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;        free(buf);</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    }</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160; </div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;    <a class="code" href="ckernel__ir__v2_8c.html#aa8d3d9a24512a941039e8a3db6674e79">ck_ir_v2_parse_int</a>(buf, <span class="stringliteral">&quot;\&quot;vocab_size\&quot;&quot;</span>, end, &amp;tmp.<a class="code" href="structCKIRV2Graph.html#a49f1785b410e7bcae526d0b1dec440f3">config</a>.<a class="code" href="structCKModelConfig.html#ad2b6c5944307859fe26f4d915d089027">vocab_size</a>);</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <a class="code" href="ckernel__ir__v2_8c.html#aa8d3d9a24512a941039e8a3db6674e79">ck_ir_v2_parse_int</a>(buf, <span class="stringliteral">&quot;\&quot;context_window\&quot;&quot;</span>, end, &amp;tmp.<a class="code" href="structCKIRV2Graph.html#a49f1785b410e7bcae526d0b1dec440f3">config</a>.<a class="code" href="structCKModelConfig.html#a18a327829d25405e92ba46a79009b89f">context_window</a>);</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    <a class="code" href="ckernel__ir__v2_8c.html#ae078a8bb851c1c4e447f3f46edf9bea8">ck_ir_v2_parse_float</a>(buf, <span class="stringliteral">&quot;\&quot;rms_norm_eps\&quot;&quot;</span>, end, &amp;tmp.<a class="code" href="structCKIRV2Graph.html#a49f1785b410e7bcae526d0b1dec440f3">config</a>.<a class="code" href="structCKModelConfig.html#a907585baeae2d601dcbf41a59785852e">rms_norm_eps</a>);</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    <a class="code" href="ckernel__ir__v2_8c.html#ae078a8bb851c1c4e447f3f46edf9bea8">ck_ir_v2_parse_float</a>(buf, <span class="stringliteral">&quot;\&quot;rope_theta\&quot;&quot;</span>, end, &amp;tmp.<a class="code" href="structCKIRV2Graph.html#a49f1785b410e7bcae526d0b1dec440f3">config</a>.<a class="code" href="structCKModelConfig.html#ae7ab37061b5249887af28ef7eb481377">rope_theta</a>);</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> *meta_key = <a class="code" href="ckernel__ir__v2_8c.html#a8be1b56b21de19f8cde1e7bfe390ffad">ck_ir_v2_find_key</a>(buf, <span class="stringliteral">&quot;\&quot;meta\&quot;&quot;</span>, end);</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    <span class="keywordflow">if</span> (meta_key) {</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span> *brace = strchr(meta_key, <span class="charliteral">&#39;{&#39;</span>);</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span> *obj_start = NULL;</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span> *obj_end = NULL;</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;        <span class="keywordflow">if</span> (brace &amp;&amp; <a class="code" href="ckernel__ir__v2_8c.html#a5b2b1869a20c7dfb93ad9ac0e8c8973e">ck_ir_v2_next_object</a>(brace, end, &amp;obj_start, &amp;obj_end)) {</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;            <a class="code" href="ckernel__ir__v2_8c.html#a96abfe5ba6fb33fbd6d98e4a1f99268e">ck_ir_v2_parse_bool</a>(obj_start, <span class="stringliteral">&quot;\&quot;has_pos_emb\&quot;&quot;</span>, obj_end, &amp;tmp.<a class="code" href="structCKIRV2Graph.html#a520e755b859ef64a2f7299c9472e9911">has_pos_emb</a>);</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;            <a class="code" href="ckernel__ir__v2_8c.html#a96abfe5ba6fb33fbd6d98e4a1f99268e">ck_ir_v2_parse_bool</a>(obj_start, <span class="stringliteral">&quot;\&quot;tie_word_embeddings\&quot;&quot;</span>, obj_end, &amp;tmp.<a class="code" href="structCKIRV2Graph.html#a5296e6ba849fa74670cf9290065ac2c9">tie_word_embeddings</a>);</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;            <a class="code" href="ckernel__ir__v2_8c.html#a96abfe5ba6fb33fbd6d98e4a1f99268e">ck_ir_v2_parse_bool</a>(obj_start, <span class="stringliteral">&quot;\&quot;fused_qkv\&quot;&quot;</span>, obj_end, &amp;tmp.<a class="code" href="structCKIRV2Graph.html#adfc2e02d30a154499cfa803b1095dc6a">fused_qkv</a>);</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;            <a class="code" href="ckernel__ir__v2_8c.html#a96abfe5ba6fb33fbd6d98e4a1f99268e">ck_ir_v2_parse_bool</a>(obj_start, <span class="stringliteral">&quot;\&quot;gated_mlp\&quot;&quot;</span>, obj_end, &amp;tmp.<a class="code" href="structCKIRV2Graph.html#a6e330ed95df881c765d7fbb5f5c62d35">gated_mlp</a>);</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;        }</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    }</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160; </div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="ckernel__ir__v2_8c.html#a30e1e73b3c441b38f7d526dd66e9e733">ck_ir_v2_parse_buffers</a>(buf, end, &amp;tmp) != 0 ||</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;        <a class="code" href="ckernel__ir__v2_8c.html#aaa7bca993e64a4a003405af642a6a7f4">ck_ir_v2_parse_nodes</a>(buf, end, &amp;tmp) != 0) {</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;        <a class="code" href="ckernel__ir__v2_8c.html#a681eb8d191d9589d6ff0ecb59536c671">ck_ir_v2_free</a>(&amp;tmp);</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;        free(buf);</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    }</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160; </div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    *graph = tmp;</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    free(buf);</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;}</div>
<div class="ttc" id="ackernel__ir__v2_8c_html_a30e1e73b3c441b38f7d526dd66e9e733"><div class="ttname"><a href="ckernel__ir__v2_8c.html#a30e1e73b3c441b38f7d526dd66e9e733">ck_ir_v2_parse_buffers</a></div><div class="ttdeci">static int ck_ir_v2_parse_buffers(const char *json, const char *end, CKIRV2Graph *graph)</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8c_source.html#l00881">ckernel_ir_v2.c:881</a></div></div>
<div class="ttc" id="ackernel__ir__v2_8c_html_a5b2b1869a20c7dfb93ad9ac0e8c8973e"><div class="ttname"><a href="ckernel__ir__v2_8c.html#a5b2b1869a20c7dfb93ad9ac0e8c8973e">ck_ir_v2_next_object</a></div><div class="ttdeci">static const char * ck_ir_v2_next_object(const char *cur, const char *end, const char **obj_start, const char **obj_end)</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8c_source.html#l00577">ckernel_ir_v2.c:577</a></div></div>
<div class="ttc" id="ackernel__ir__v2_8c_html_a681eb8d191d9589d6ff0ecb59536c671"><div class="ttname"><a href="ckernel__ir__v2_8c.html#a681eb8d191d9589d6ff0ecb59536c671">ck_ir_v2_free</a></div><div class="ttdeci">void ck_ir_v2_free(CKIRV2Graph *graph)</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8c_source.html#l00034">ckernel_ir_v2.c:34</a></div></div>
<div class="ttc" id="ackernel__ir__v2_8c_html_a8be1b56b21de19f8cde1e7bfe390ffad"><div class="ttname"><a href="ckernel__ir__v2_8c.html#a8be1b56b21de19f8cde1e7bfe390ffad">ck_ir_v2_find_key</a></div><div class="ttdeci">static const char * ck_ir_v2_find_key(const char *json, const char *key, const char *end)</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8c_source.html#l00637">ckernel_ir_v2.c:637</a></div></div>
<div class="ttc" id="ackernel__ir__v2_8c_html_a96abfe5ba6fb33fbd6d98e4a1f99268e"><div class="ttname"><a href="ckernel__ir__v2_8c.html#a96abfe5ba6fb33fbd6d98e4a1f99268e">ck_ir_v2_parse_bool</a></div><div class="ttdeci">static int ck_ir_v2_parse_bool(const char *json, const char *key, const char *end, int *out_val)</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8c_source.html#l00673">ckernel_ir_v2.c:673</a></div></div>
<div class="ttc" id="ackernel__ir__v2_8c_html_aa8d3d9a24512a941039e8a3db6674e79"><div class="ttname"><a href="ckernel__ir__v2_8c.html#aa8d3d9a24512a941039e8a3db6674e79">ck_ir_v2_parse_int</a></div><div class="ttdeci">static int ck_ir_v2_parse_int(const char *json, const char *key, const char *end, int *out_val)</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8c_source.html#l00652">ckernel_ir_v2.c:652</a></div></div>
<div class="ttc" id="ackernel__ir__v2_8c_html_aaa7bca993e64a4a003405af642a6a7f4"><div class="ttname"><a href="ckernel__ir__v2_8c.html#aaa7bca993e64a4a003405af642a6a7f4">ck_ir_v2_parse_nodes</a></div><div class="ttdeci">static int ck_ir_v2_parse_nodes(const char *json, const char *end, CKIRV2Graph *graph)</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8c_source.html#l01005">ckernel_ir_v2.c:1005</a></div></div>
<div class="ttc" id="ackernel__ir__v2_8c_html_ae078a8bb851c1c4e447f3f46edf9bea8"><div class="ttname"><a href="ckernel__ir__v2_8c.html#ae078a8bb851c1c4e447f3f46edf9bea8">ck_ir_v2_parse_float</a></div><div class="ttdeci">static int ck_ir_v2_parse_float(const char *json, const char *key, const char *end, float *out_val)</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8c_source.html#l00701">ckernel_ir_v2.c:701</a></div></div>
<div class="ttc" id="astructCKIRV2Graph_html"><div class="ttname"><a href="structCKIRV2Graph.html">CKIRV2Graph</a></div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8h_source.html#l00055">ckernel_ir_v2.h:55</a></div></div>
<div class="ttc" id="astructCKModelConfig_html_a18a327829d25405e92ba46a79009b89f"><div class="ttname"><a href="structCKModelConfig.html#a18a327829d25405e92ba46a79009b89f">CKModelConfig::context_window</a></div><div class="ttdeci">int context_window</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir_8h_source.html#l00030">ckernel_ir.h:30</a></div></div>
<div class="ttc" id="astructCKModelConfig_html_a2da9b0b988ccf3b7117a611da5984d34"><div class="ttname"><a href="structCKModelConfig.html#a2da9b0b988ccf3b7117a611da5984d34">CKModelConfig::intermediate_size</a></div><div class="ttdeci">int intermediate_size</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir_8h_source.html#l00026">ckernel_ir.h:26</a></div></div>
<div class="ttc" id="astructCKModelConfig_html_a3e5c8e6d2da07805365ec6b4db29b9ea"><div class="ttname"><a href="structCKModelConfig.html#a3e5c8e6d2da07805365ec6b4db29b9ea">CKModelConfig::num_heads</a></div><div class="ttdeci">int num_heads</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir_8h_source.html#l00027">ckernel_ir.h:27</a></div></div>
<div class="ttc" id="astructCKModelConfig_html_a902b19335449fa61c1e532d9999aa342"><div class="ttname"><a href="structCKModelConfig.html#a902b19335449fa61c1e532d9999aa342">CKModelConfig::num_kv_heads</a></div><div class="ttdeci">int num_kv_heads</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir_8h_source.html#l00028">ckernel_ir.h:28</a></div></div>
<div class="ttc" id="astructCKModelConfig_html_a907585baeae2d601dcbf41a59785852e"><div class="ttname"><a href="structCKModelConfig.html#a907585baeae2d601dcbf41a59785852e">CKModelConfig::rms_norm_eps</a></div><div class="ttdeci">float rms_norm_eps</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir_8h_source.html#l00031">ckernel_ir.h:31</a></div></div>
<div class="ttc" id="astructCKModelConfig_html_ad2b6c5944307859fe26f4d915d089027"><div class="ttname"><a href="structCKModelConfig.html#ad2b6c5944307859fe26f4d915d089027">CKModelConfig::vocab_size</a></div><div class="ttdeci">int vocab_size</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir_8h_source.html#l00029">ckernel_ir.h:29</a></div></div>
<div class="ttc" id="astructCKModelConfig_html_ae7ab37061b5249887af28ef7eb481377"><div class="ttname"><a href="structCKModelConfig.html#ae7ab37061b5249887af28ef7eb481377">CKModelConfig::rope_theta</a></div><div class="ttdeci">float rope_theta</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir_8h_source.html#l00032">ckernel_ir.h:32</a></div></div>
<div class="ttc" id="astructCKModelConfig_html_afd04ffe4db48600b90f32904c49d73af"><div class="ttname"><a href="structCKModelConfig.html#afd04ffe4db48600b90f32904c49d73af">CKModelConfig::hidden_size</a></div><div class="ttdeci">int hidden_size</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir_8h_source.html#l00025">ckernel_ir.h:25</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ckernel__ir__v2_8c_source.html#l00637">ck_ir_v2_find_key()</a>, <a class="el" href="ckernel__ir__v2_8c_source.html#l00034">ck_ir_v2_free()</a>, <a class="el" href="ckernel__ir__v2_8c_source.html#l00577">ck_ir_v2_next_object()</a>, <a class="el" href="ckernel__ir__v2_8c_source.html#l00673">ck_ir_v2_parse_bool()</a>, <a class="el" href="ckernel__ir__v2_8c_source.html#l00881">ck_ir_v2_parse_buffers()</a>, <a class="el" href="ckernel__ir__v2_8c_source.html#l00701">ck_ir_v2_parse_float()</a>, <a class="el" href="ckernel__ir__v2_8c_source.html#l00652">ck_ir_v2_parse_int()</a>, <a class="el" href="ckernel__ir__v2_8c_source.html#l01005">ck_ir_v2_parse_nodes()</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00056">CKIRV2Graph::config</a>, <a class="el" href="ckernel__ir_8h_source.html#l00030">CKModelConfig::context_window</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00059">CKIRV2Graph::fused_qkv</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00060">CKIRV2Graph::gated_mlp</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00057">CKIRV2Graph::has_pos_emb</a>, <a class="el" href="ckernel__ir_8h_source.html#l00025">CKModelConfig::hidden_size</a>, <a class="el" href="ckernel__ir_8h_source.html#l00026">CKModelConfig::intermediate_size</a>, <a class="el" href="ckernel__ir_8h_source.html#l00027">CKModelConfig::num_heads</a>, <a class="el" href="ckernel__ir_8h_source.html#l00028">CKModelConfig::num_kv_heads</a>, <a class="el" href="ckernel__ir_8h_source.html#l00024">CKModelConfig::num_layers</a>, <a class="el" href="ckernel__ir_8h_source.html#l00031">CKModelConfig::rms_norm_eps</a>, <a class="el" href="ckernel__ir_8h_source.html#l00032">CKModelConfig::rope_theta</a>, <a class="el" href="ckernel__ir__v2_8h_source.html#l00058">CKIRV2Graph::tie_word_embeddings</a>, and <a class="el" href="ckernel__ir_8h_source.html#l00029">CKModelConfig::vocab_size</a>.</p>

<p class="reference">Referenced by <a class="el" href="ckernel__ir__v2__demo_8c_source.html#l00025">main()</a>.</p>

</div>
</div>
<a id="a6cdd7c6d88800527b0c3633beecd077d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6cdd7c6d88800527b0c3633beecd077d">&#9670;&nbsp;</a></span>ck_ir_v2_serialize_json()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ck_ir_v2_serialize_json </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structCKIRV2Graph.html">CKIRV2Graph</a> *&#160;</td>
          <td class="paramname"><em>graph</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ckernel__ir__v2_8c_source.html#l00511">511</a> of file <a class="el" href="ckernel__ir__v2_8c_source.html">ckernel_ir_v2.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;{</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="ckernel__ir__v2_8c.html#a209e3eb32f2a8291f63a6503e031b78a">ck_ir_v2_serialize_json_internal</a>(graph, NULL, NULL, -1, -1, path);</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;}</div>
<div class="ttc" id="ackernel__ir__v2_8c_html_a209e3eb32f2a8291f63a6503e031b78a"><div class="ttname"><a href="ckernel__ir__v2_8c.html#a209e3eb32f2a8291f63a6503e031b78a">ck_ir_v2_serialize_json_internal</a></div><div class="ttdeci">static int ck_ir_v2_serialize_json_internal(const CKIRV2Graph *graph, const CKMemPlan *plan, const char *mode, int tokens_override, int base_context_window, const char *path)</div><div class="ttdef"><b>Definition:</b> <a href="ckernel__ir__v2_8c_source.html#l00365">ckernel_ir_v2.c:365</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ckernel__ir__v2_8c_source.html#l00365">ck_ir_v2_serialize_json_internal()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ckernel__ir__v2__demo_8c_source.html#l00025">main()</a>.</p>

</div>
</div>
<a id="a3b6c997fea78e5e450c1007074ec0ae2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3b6c997fea78e5e450c1007074ec0ae2">&#9670;&nbsp;</a></span>ck_ir_v2_serialize_json_with_plan()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ck_ir_v2_serialize_json_with_plan </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structCKIRV2Graph.html">CKIRV2Graph</a> *&#160;</td>
          <td class="paramname"><em>graph</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structCKMemPlan.html">CKMemPlan</a> *&#160;</td>
          <td class="paramname"><em>plan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>tokens_override</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>base_context_window</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="ckernel__ir__v2__lower_8c_source.html#l00219">ck_ir_v2_lower_emit_json()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="ckernel__ir__v2_8h.html">ckernel_ir_v2.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
