<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.9.1" xml:lang="en-US">
  <compounddef id="ckernel__mem__plan_8c" kind="file" language="C++">
    <compoundname>ckernel_mem_plan.c</compoundname>
    <includes refid="ckernel__mem__plan_8h" local="yes">ckernel_mem_plan.h</includes>
    <includes refid="ckernel__dtype_8h" local="yes">ckernel_dtype.h</includes>
    <includes local="no">stdlib.h</includes>
    <includes local="no">string.h</includes>
    <incdepgraph>
      <node id="9">
        <label>ckernel_dtype.h</label>
        <link refid="ckernel__dtype_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
      </node>
      <node id="5">
        <label>stdint.h</label>
      </node>
      <node id="10">
        <label>stdlib.h</label>
      </node>
      <node id="1">
        <label>ckernel_mem_plan.c</label>
        <link refid="ckernel__mem__plan_8c"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
      </node>
      <node id="3">
        <label>ckernel_ir_v2.h</label>
        <link refid="ckernel__ir__v2_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="8">
        <label>stddef.h</label>
      </node>
      <node id="7">
        <label>ckernel_kernel_specs.h</label>
        <link refid="ckernel__kernel__specs_8h"/>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
      </node>
      <node id="4">
        <label>ckernel_ir.h</label>
        <link refid="ckernel__ir_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
      </node>
      <node id="11">
        <label>string.h</label>
      </node>
      <node id="2">
        <label>ckernel_mem_plan.h</label>
        <link refid="ckernel__mem__plan_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
      </node>
      <node id="6">
        <label>stdio.h</label>
      </node>
    </incdepgraph>
    <innerclass refid="structCKIRV2AlignInfo" prot="public">CKIRV2AlignInfo</innerclass>
      <sectiondef kind="func">
      <memberdef kind="function" id="ckernel__mem__plan_8c_1a19108c1ddea653d46840daefcf542bb5" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>size_t</type>
        <definition>static size_t align_up_bytes</definition>
        <argsstring>(size_t n, size_t align)</argsstring>
        <name>align_up_bytes</name>
        <param>
          <type>size_t</type>
          <declname>n</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>align</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/antshiv/Workspace/C-Kernel-Engine/src/ckernel_mem_plan.c" line="15" column="15" bodyfile="/home/antshiv/Workspace/C-Kernel-Engine/src/ckernel_mem_plan.c" bodystart="15" bodyend="19"/>
        <referencedby refid="ckernel__mem__plan_8c_1a1a43f9f3bcd4506c4f8c237af70f0a04" compoundref="ckernel__mem__plan_8c" startline="21" endline="26">align_up_elems</referencedby>
        <referencedby refid="ckernel__mem__plan_8c_1a2ac35f81413e92025c1492d78f45a703" compoundref="ckernel__mem__plan_8c" startline="146" endline="214">build_plan</referencedby>
      </memberdef>
      <memberdef kind="function" id="ckernel__mem__plan_8c_1a1a43f9f3bcd4506c4f8c237af70f0a04" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>size_t</type>
        <definition>static size_t align_up_elems</definition>
        <argsstring>(size_t elems, size_t elem_bytes, size_t align_bytes)</argsstring>
        <name>align_up_elems</name>
        <param>
          <type>size_t</type>
          <declname>elems</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>elem_bytes</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>align_bytes</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/antshiv/Workspace/C-Kernel-Engine/src/ckernel_mem_plan.c" line="21" column="15" bodyfile="/home/antshiv/Workspace/C-Kernel-Engine/src/ckernel_mem_plan.c" bodystart="21" bodyend="26"/>
        <references refid="ckernel__mem__plan_8c_1a19108c1ddea653d46840daefcf542bb5" compoundref="ckernel__mem__plan_8c" startline="15" endline="19">align_up_bytes</references>
        <referencedby refid="ckernel__mem__plan_8c_1a2ac35f81413e92025c1492d78f45a703" compoundref="ckernel__mem__plan_8c" startline="146" endline="214">build_plan</referencedby>
      </memberdef>
      <memberdef kind="function" id="ckernel__mem__plan_8c_1a648ff92cf8d5c0cc9cd28c3b4567a6a6" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="ckernel__mem__plan_8h_1a7593aeefed160055e5352bda2cb27873" kindref="member">CKMemArenaKind</ref></type>
        <definition>static CKMemArenaKind arena_for_role</definition>
        <argsstring>(CKBufferRole role)</argsstring>
        <name>arena_for_role</name>
        <param>
          <type><ref refid="ckernel__kernel__specs_8h_1a1c2c408a04c891ae526f5d909d0c8401" kindref="member">CKBufferRole</ref></type>
          <declname>role</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/antshiv/Workspace/C-Kernel-Engine/src/ckernel_mem_plan.c" line="84" column="23" bodyfile="/home/antshiv/Workspace/C-Kernel-Engine/src/ckernel_mem_plan.c" bodystart="84" bodyend="98"/>
        <references refid="ckernel__mem__plan_8h_1a7593aeefed160055e5352bda2cb27873ab440f0630c9e4a2b22f79b82e76699f0" compoundref="ckernel__mem__plan_8h" startline="16">CK_MEM_ARENA_ACTIVATIONS</references>
        <references refid="ckernel__mem__plan_8h_1a7593aeefed160055e5352bda2cb27873a32ad00dbbce0c0eb6486d21de6a43492" compoundref="ckernel__mem__plan_8h" startline="17">CK_MEM_ARENA_GRADS</references>
        <references refid="ckernel__mem__plan_8h_1a7593aeefed160055e5352bda2cb27873a904b7e65d05595093e2c5ed58578a3be" compoundref="ckernel__mem__plan_8h" startline="15">CK_MEM_ARENA_WEIGHTS</references>
        <references refid="ckernel__kernel__specs_8h_1a1c2c408a04c891ae526f5d909d0c8401ada6ca31e0365c782ee073e91f8516bea" compoundref="ckernel__kernel__specs_8h" startline="39">CK_ROLE_ACTIVATION</references>
        <references refid="ckernel__kernel__specs_8h_1a1c2c408a04c891ae526f5d909d0c8401a9812ba1491a1ec75f2d2a186de1fe806" compoundref="ckernel__kernel__specs_8h" startline="42">CK_ROLE_GRAD</references>
        <references refid="ckernel__kernel__specs_8h_1a1c2c408a04c891ae526f5d909d0c8401af78578048797064d7f8b235c8393e39f" compoundref="ckernel__kernel__specs_8h" startline="37">CK_ROLE_INPUT</references>
        <references refid="ckernel__kernel__specs_8h_1a1c2c408a04c891ae526f5d909d0c8401afbfc5f2a6199ecf56c8d3ccd4b4145fa" compoundref="ckernel__kernel__specs_8h" startline="38">CK_ROLE_OUTPUT</references>
        <references refid="ckernel__kernel__specs_8h_1a1c2c408a04c891ae526f5d909d0c8401a8fbf92f873c30e7522e194bb8e936041" compoundref="ckernel__kernel__specs_8h" startline="41">CK_ROLE_SCRATCH</references>
        <references refid="ckernel__kernel__specs_8h_1a1c2c408a04c891ae526f5d909d0c8401a1e808475314280ece78fbbfa6aec27c6" compoundref="ckernel__kernel__specs_8h" startline="40">CK_ROLE_WEIGHT</references>
        <referencedby refid="ckernel__mem__plan_8c_1a2ac35f81413e92025c1492d78f45a703" compoundref="ckernel__mem__plan_8c" startline="146" endline="214">build_plan</referencedby>
      </memberdef>
      <memberdef kind="function" id="ckernel__mem__plan_8c_1abb79ec65608b1997ebc6ee5983c24504" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int buffer_enabled</definition>
        <argsstring>(const CKIRV2Graph *graph, const CKIRV2Buffer *buf, int training_enabled)</argsstring>
        <name>buffer_enabled</name>
        <param>
          <type>const <ref refid="structCKIRV2Graph" kindref="compound">CKIRV2Graph</ref> *</type>
          <declname>graph</declname>
        </param>
        <param>
          <type>const <ref refid="structCKIRV2Buffer" kindref="compound">CKIRV2Buffer</ref> *</type>
          <declname>buf</declname>
        </param>
        <param>
          <type>int</type>
          <declname>training_enabled</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/antshiv/Workspace/C-Kernel-Engine/src/ckernel_mem_plan.c" line="100" column="12" bodyfile="/home/antshiv/Workspace/C-Kernel-Engine/src/ckernel_mem_plan.c" bodystart="100" bodyend="131"/>
        <references refid="ckernel__kernel__specs_8h_1a1c2c408a04c891ae526f5d909d0c8401a9812ba1491a1ec75f2d2a186de1fe806" compoundref="ckernel__kernel__specs_8h" startline="42">CK_ROLE_GRAD</references>
        <references refid="structCKIRV2Buffer_1a50f6cc398851b0c231520444e855113b" compoundref="ckernel__ir__v2_8h" startline="32">CKIRV2Buffer::condition</references>
        <references refid="structCKIRV2Graph_1a49f1785b410e7bcae526d0b1dec440f3" compoundref="ckernel__ir__v2_8h" startline="56">CKIRV2Graph::config</references>
        <references refid="structCKIRV2Graph_1a520e755b859ef64a2f7299c9472e9911" compoundref="ckernel__ir__v2_8h" startline="57">CKIRV2Graph::has_pos_emb</references>
        <references refid="structCKIRV2Buffer_1a3c077f1f0bdfd4b832a17aea56c823d1" compoundref="ckernel__ir__v2_8h" startline="27">CKIRV2Buffer::role</references>
        <references refid="structCKModelConfig_1ae7ab37061b5249887af28ef7eb481377" compoundref="ckernel__ir_8h" startline="32">CKModelConfig::rope_theta</references>
        <referencedby refid="ckernel__mem__plan_8c_1a2ac35f81413e92025c1492d78f45a703" compoundref="ckernel__mem__plan_8c" startline="146" endline="214">build_plan</referencedby>
      </memberdef>
      <memberdef kind="function" id="ckernel__mem__plan_8c_1a2ac35f81413e92025c1492d78f45a703" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int build_plan</definition>
        <argsstring>(const CKIRV2Graph *graph, CKMemPlan *plan, size_t alignment_bytes, int training_enabled, int tokens_override)</argsstring>
        <name>build_plan</name>
        <param>
          <type>const <ref refid="structCKIRV2Graph" kindref="compound">CKIRV2Graph</ref> *</type>
          <declname>graph</declname>
        </param>
        <param>
          <type><ref refid="structCKMemPlan" kindref="compound">CKMemPlan</ref> *</type>
          <declname>plan</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>alignment_bytes</declname>
        </param>
        <param>
          <type>int</type>
          <declname>training_enabled</declname>
        </param>
        <param>
          <type>int</type>
          <declname>tokens_override</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/antshiv/Workspace/C-Kernel-Engine/src/ckernel_mem_plan.c" line="146" column="12" bodyfile="/home/antshiv/Workspace/C-Kernel-Engine/src/ckernel_mem_plan.c" bodystart="146" bodyend="214"/>
        <references refid="structCKIRV2Buffer_1a92f6356a2149550923b521d604bc9486" compoundref="ckernel__ir__v2_8h" startline="31">CKIRV2Buffer::alias_of</references>
        <references refid="ckernel__mem__plan_8c_1a19108c1ddea653d46840daefcf542bb5" compoundref="ckernel__mem__plan_8c" startline="15" endline="19">align_up_bytes</references>
        <references refid="ckernel__mem__plan_8c_1a1a43f9f3bcd4506c4f8c237af70f0a04" compoundref="ckernel__mem__plan_8c" startline="21" endline="26">align_up_elems</references>
        <references refid="structCKMemPlan_1a8e5e24bcf347c4fe2d45e76be8c2351e" compoundref="ckernel__mem__plan_8h" startline="32">CKMemPlan::alignment_bytes</references>
        <references refid="structCKMemSpan_1a818835e50806e8d1fd141cf97b4ea806" compoundref="ckernel__mem__plan_8h" startline="23">CKMemSpan::arena</references>
        <references refid="ckernel__mem__plan_8c_1a648ff92cf8d5c0cc9cd28c3b4567a6a6" compoundref="ckernel__mem__plan_8c" startline="84" endline="98">arena_for_role</references>
        <references refid="ckernel__mem__plan_8c_1abb79ec65608b1997ebc6ee5983c24504" compoundref="ckernel__mem__plan_8c" startline="100" endline="131">buffer_enabled</references>
        <references refid="structCKMemSpan_1a0d967f0eca56cf7113b4552d67b208e5" compoundref="ckernel__mem__plan_8h" startline="22">CKMemSpan::buffer_id</references>
        <references refid="structCKIRV2Graph_1ad2d61568dda8232b3252da14a53ffc03" compoundref="ckernel__ir__v2_8h" startline="62">CKIRV2Graph::buffers</references>
        <references refid="ckernel__dtype_8h_1afb7fc50f1a3ed20ee55989027c744c8f" compoundref="ckernel__dtype_8h" startline="115" endline="123">ck_dtype_row_bytes</references>
        <references refid="ckernel__mem__plan_8h_1a7593aeefed160055e5352bda2cb27873a8f8f213ffa426f0656a6de5c1fae8fbb" compoundref="ckernel__mem__plan_8h" startline="18">CK_MEM_ARENA_COUNT</references>
        <references refid="ckernel__mem__plan_8h_1a7b0ecac54309914511507bc80cdce744" compoundref="ckernel__mem__plan_8h" startline="12">CK_MEM_PLAN_DEFAULT_ALIGN</references>
        <references refid="structCKIRV2Graph_1a49f1785b410e7bcae526d0b1dec440f3" compoundref="ckernel__ir__v2_8h" startline="56">CKIRV2Graph::config</references>
        <references refid="structCKModelConfig_1a18a327829d25405e92ba46a79009b89f" compoundref="ckernel__ir_8h" startline="30">CKModelConfig::context_window</references>
        <references refid="structCKIRV2Buffer_1acb1dc8a19c8fad476e89ab40bd6d31bf" compoundref="ckernel__ir__v2_8h" startline="28">CKIRV2Buffer::dtype</references>
        <references refid="ckernel__mem__plan_8c_1a615c5d3cfa93ae333a302f9c14b4927c" compoundref="ckernel__mem__plan_8c" startline="133" endline="144">find_buffer_by_name</references>
        <references refid="structCKModelConfig_1afd04ffe4db48600b90f32904c49d73af" compoundref="ckernel__ir_8h" startline="25">CKModelConfig::hidden_size</references>
        <references refid="structCKModelConfig_1a2da9b0b988ccf3b7117a611da5984d34" compoundref="ckernel__ir_8h" startline="26">CKModelConfig::intermediate_size</references>
        <references refid="structCKIRV2Graph_1aeb72a3027aef579daf9a4ac090ac71ba" compoundref="ckernel__ir__v2_8h" startline="61">CKIRV2Graph::num_buffers</references>
        <references refid="structCKModelConfig_1a3e5c8e6d2da07805365ec6b4db29b9ea" compoundref="ckernel__ir_8h" startline="27">CKModelConfig::num_heads</references>
        <references refid="structCKMemPlan_1a7c1dd8cbe777a1f0a40af32a417fdc37" compoundref="ckernel__mem__plan_8h" startline="30">CKMemPlan::num_spans</references>
        <references refid="structCKMemSpan_1af281883bfadbea82697819bbf12aa759" compoundref="ckernel__mem__plan_8h" startline="24">CKMemSpan::offset_bytes</references>
        <references refid="ckernel__mem__plan_8c_1a1a08695b8f684d75f5a5e8ac277da6f9" compoundref="ckernel__mem__plan_8c" startline="65" endline="82">resolve_shape_elems</references>
        <references refid="structCKIRV2Buffer_1a3c077f1f0bdfd4b832a17aea56c823d1" compoundref="ckernel__ir__v2_8h" startline="27">CKIRV2Buffer::role</references>
        <references refid="structCKIRV2Buffer_1a22f159608ef2fbcdfdd84704ae3f5da4" compoundref="ckernel__ir__v2_8h" startline="29">CKIRV2Buffer::shape</references>
        <references refid="structCKMemSpan_1a1a8d564452e900aa6e0978ac20b63c5e" compoundref="ckernel__mem__plan_8h" startline="25">CKMemSpan::size_bytes</references>
        <references refid="structCKMemPlan_1a2eafa236d6d9a88944d798cdbd43737d" compoundref="ckernel__mem__plan_8h" startline="29">CKMemPlan::spans</references>
        <references refid="structCKMemPlan_1aa2e911b6ed9b128563d25bc6cec958d8" compoundref="ckernel__mem__plan_8h" startline="31">CKMemPlan::total_bytes</references>
        <referencedby refid="ckernel__mem__plan_8h_1a92e5aeb38254a89e211012c7cfa1886c" compoundref="ckernel__mem__plan_8c" startline="216" endline="221">ck_mem_plan_build_inference</referencedby>
        <referencedby refid="ckernel__mem__plan_8h_1ab2ccd14ce31d7ef0d57d5620a96a23f4" compoundref="ckernel__mem__plan_8c" startline="230" endline="236">ck_mem_plan_build_inference_with_tokens</referencedby>
        <referencedby refid="ckernel__mem__plan_8h_1a14f34bf1cb156c5a07296e5328f5c0cc" compoundref="ckernel__mem__plan_8c" startline="223" endline="228">ck_mem_plan_build_training</referencedby>
        <referencedby refid="ckernel__mem__plan_8h_1a57db8942b533ff570008d5d04a9f7c1e" compoundref="ckernel__mem__plan_8c" startline="238" endline="244">ck_mem_plan_build_training_with_tokens</referencedby>
      </memberdef>
      <memberdef kind="function" id="ckernel__mem__plan_8c_1a92e5aeb38254a89e211012c7cfa1886c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int ck_mem_plan_build_inference</definition>
        <argsstring>(const CKIRV2Graph *graph, CKMemPlan *plan, size_t alignment_bytes)</argsstring>
        <name>ck_mem_plan_build_inference</name>
        <param>
          <type>const <ref refid="structCKIRV2Graph" kindref="compound">CKIRV2Graph</ref> *</type>
          <declname>graph</declname>
        </param>
        <param>
          <type><ref refid="structCKMemPlan" kindref="compound">CKMemPlan</ref> *</type>
          <declname>plan</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>alignment_bytes</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/antshiv/Workspace/C-Kernel-Engine/src/ckernel_mem_plan.c" line="216" column="5" bodyfile="/home/antshiv/Workspace/C-Kernel-Engine/src/ckernel_mem_plan.c" bodystart="216" bodyend="221"/>
        <references refid="ckernel__mem__plan_8c_1a2ac35f81413e92025c1492d78f45a703" compoundref="ckernel__mem__plan_8c" startline="146" endline="214">build_plan</references>
      </memberdef>
      <memberdef kind="function" id="ckernel__mem__plan_8c_1ab2ccd14ce31d7ef0d57d5620a96a23f4" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int ck_mem_plan_build_inference_with_tokens</definition>
        <argsstring>(const CKIRV2Graph *graph, CKMemPlan *plan, size_t alignment_bytes, int tokens_override)</argsstring>
        <name>ck_mem_plan_build_inference_with_tokens</name>
        <param>
          <type>const <ref refid="structCKIRV2Graph" kindref="compound">CKIRV2Graph</ref> *</type>
          <declname>graph</declname>
        </param>
        <param>
          <type><ref refid="structCKMemPlan" kindref="compound">CKMemPlan</ref> *</type>
          <declname>plan</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>alignment_bytes</declname>
        </param>
        <param>
          <type>int</type>
          <declname>tokens_override</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/antshiv/Workspace/C-Kernel-Engine/src/ckernel_mem_plan.c" line="230" column="5" bodyfile="/home/antshiv/Workspace/C-Kernel-Engine/src/ckernel_mem_plan.c" bodystart="230" bodyend="236"/>
        <references refid="ckernel__mem__plan_8c_1a2ac35f81413e92025c1492d78f45a703" compoundref="ckernel__mem__plan_8c" startline="146" endline="214">build_plan</references>
        <referencedby refid="ckernel__codegen__v2_8h_1a359e5ca69869c47ed1af896696d5fa2a" compoundref="ckernel__codegen__v2_8c" startline="10" endline="69">ck_codegen_v2_emit_runtime</referencedby>
        <referencedby refid="ckernel__ir__v2__lower_8h_1ad92c2089721962b2160c2cab45ace188" compoundref="ckernel__ir__v2__lower_8c" startline="177" endline="217">ck_ir_v2_lower_graph</referencedby>
      </memberdef>
      <memberdef kind="function" id="ckernel__mem__plan_8c_1a14f34bf1cb156c5a07296e5328f5c0cc" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int ck_mem_plan_build_training</definition>
        <argsstring>(const CKIRV2Graph *graph, CKMemPlan *plan, size_t alignment_bytes)</argsstring>
        <name>ck_mem_plan_build_training</name>
        <param>
          <type>const <ref refid="structCKIRV2Graph" kindref="compound">CKIRV2Graph</ref> *</type>
          <declname>graph</declname>
        </param>
        <param>
          <type><ref refid="structCKMemPlan" kindref="compound">CKMemPlan</ref> *</type>
          <declname>plan</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>alignment_bytes</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/antshiv/Workspace/C-Kernel-Engine/src/ckernel_mem_plan.c" line="223" column="5" bodyfile="/home/antshiv/Workspace/C-Kernel-Engine/src/ckernel_mem_plan.c" bodystart="223" bodyend="228"/>
        <references refid="ckernel__mem__plan_8c_1a2ac35f81413e92025c1492d78f45a703" compoundref="ckernel__mem__plan_8c" startline="146" endline="214">build_plan</references>
      </memberdef>
      <memberdef kind="function" id="ckernel__mem__plan_8c_1a57db8942b533ff570008d5d04a9f7c1e" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int ck_mem_plan_build_training_with_tokens</definition>
        <argsstring>(const CKIRV2Graph *graph, CKMemPlan *plan, size_t alignment_bytes, int tokens_override)</argsstring>
        <name>ck_mem_plan_build_training_with_tokens</name>
        <param>
          <type>const <ref refid="structCKIRV2Graph" kindref="compound">CKIRV2Graph</ref> *</type>
          <declname>graph</declname>
        </param>
        <param>
          <type><ref refid="structCKMemPlan" kindref="compound">CKMemPlan</ref> *</type>
          <declname>plan</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>alignment_bytes</declname>
        </param>
        <param>
          <type>int</type>
          <declname>tokens_override</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/antshiv/Workspace/C-Kernel-Engine/src/ckernel_mem_plan.c" line="238" column="5" bodyfile="/home/antshiv/Workspace/C-Kernel-Engine/src/ckernel_mem_plan.c" bodystart="238" bodyend="244"/>
        <references refid="ckernel__mem__plan_8c_1a2ac35f81413e92025c1492d78f45a703" compoundref="ckernel__mem__plan_8c" startline="146" endline="214">build_plan</references>
        <referencedby refid="ckernel__codegen__v2_8h_1a359e5ca69869c47ed1af896696d5fa2a" compoundref="ckernel__codegen__v2_8c" startline="10" endline="69">ck_codegen_v2_emit_runtime</referencedby>
        <referencedby refid="ckernel__ir__v2__lower_8h_1ad92c2089721962b2160c2cab45ace188" compoundref="ckernel__ir__v2__lower_8c" startline="177" endline="217">ck_ir_v2_lower_graph</referencedby>
      </memberdef>
      <memberdef kind="function" id="ckernel__mem__plan_8c_1a69f7ae632754a94b1a227da5a6633fb1" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void ck_mem_plan_free</definition>
        <argsstring>(CKMemPlan *plan)</argsstring>
        <name>ck_mem_plan_free</name>
        <param>
          <type><ref refid="structCKMemPlan" kindref="compound">CKMemPlan</ref> *</type>
          <declname>plan</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/antshiv/Workspace/C-Kernel-Engine/src/ckernel_mem_plan.c" line="246" column="6" bodyfile="/home/antshiv/Workspace/C-Kernel-Engine/src/ckernel_mem_plan.c" bodystart="246" bodyend="253"/>
        <references refid="structCKMemPlan_1a2eafa236d6d9a88944d798cdbd43737d" compoundref="ckernel__mem__plan_8h" startline="29">CKMemPlan::spans</references>
        <referencedby refid="ckernel__codegen__v2_8h_1a359e5ca69869c47ed1af896696d5fa2a" compoundref="ckernel__codegen__v2_8c" startline="10" endline="69">ck_codegen_v2_emit_runtime</referencedby>
        <referencedby refid="ckernel__ir__v2__lower_8h_1ab2afc44e824ca8ed4de7e445f9cc06d3" compoundref="ckernel__ir__v2__lower_8c" startline="219" endline="241">ck_ir_v2_lower_emit_json</referencedby>
        <referencedby refid="ckernel__ir__v2__lower_8h_1ad92c2089721962b2160c2cab45ace188" compoundref="ckernel__ir__v2__lower_8c" startline="177" endline="217">ck_ir_v2_lower_graph</referencedby>
      </memberdef>
      <memberdef kind="function" id="ckernel__mem__plan_8c_1a615c5d3cfa93ae333a302f9c14b4927c" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int find_buffer_by_name</definition>
        <argsstring>(const CKIRV2Graph *graph, const char *name)</argsstring>
        <name>find_buffer_by_name</name>
        <param>
          <type>const <ref refid="structCKIRV2Graph" kindref="compound">CKIRV2Graph</ref> *</type>
          <declname>graph</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>name</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/antshiv/Workspace/C-Kernel-Engine/src/ckernel_mem_plan.c" line="133" column="12" bodyfile="/home/antshiv/Workspace/C-Kernel-Engine/src/ckernel_mem_plan.c" bodystart="133" bodyend="144"/>
        <references refid="structCKIRV2Graph_1ad2d61568dda8232b3252da14a53ffc03" compoundref="ckernel__ir__v2_8h" startline="62">CKIRV2Graph::buffers</references>
        <references refid="structCKIRV2Buffer_1a2f431336505aa19000ed2535be85bc71" compoundref="ckernel__ir__v2_8h" startline="25">CKIRV2Buffer::name</references>
        <references refid="structCKIRV2Graph_1aeb72a3027aef579daf9a4ac090ac71ba" compoundref="ckernel__ir__v2_8h" startline="61">CKIRV2Graph::num_buffers</references>
        <referencedby refid="ckernel__mem__plan_8c_1a2ac35f81413e92025c1492d78f45a703" compoundref="ckernel__mem__plan_8c" startline="146" endline="214">build_plan</referencedby>
      </memberdef>
      <memberdef kind="function" id="ckernel__mem__plan_8c_1a0d9ae71bc7bcfb4654c4c2c5bdaf8e4e" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>size_t</type>
        <definition>static size_t resolve_dim</definition>
        <argsstring>(const CKModelConfig *cfg, const CKIRV2AlignInfo *align, CKDimKind kind, int tokens_override)</argsstring>
        <name>resolve_dim</name>
        <param>
          <type>const <ref refid="structCKModelConfig" kindref="compound">CKModelConfig</ref> *</type>
          <declname>cfg</declname>
        </param>
        <param>
          <type>const CKIRV2AlignInfo *</type>
          <declname>align</declname>
        </param>
        <param>
          <type><ref refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390" kindref="member">CKDimKind</ref></type>
          <declname>kind</declname>
        </param>
        <param>
          <type>int</type>
          <declname>tokens_override</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/antshiv/Workspace/C-Kernel-Engine/src/ckernel_mem_plan.c" line="28" column="15" bodyfile="/home/antshiv/Workspace/C-Kernel-Engine/src/ckernel_mem_plan.c" bodystart="28" bodyend="63"/>
        <references refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390a3cdb63a663d3f19f1d2d9aeb8c124a38" compoundref="ckernel__kernel__specs_8h" startline="16">CK_DIM_ALIGNED_CTX</references>
        <references refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390a29f29d6e4d6a83d51a84464caf90b5ad" compoundref="ckernel__kernel__specs_8h" startline="11">CK_DIM_ALIGNED_EMBED</references>
        <references refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390a89205855111843486cea0674ca1472bb" compoundref="ckernel__kernel__specs_8h" startline="13">CK_DIM_ALIGNED_HEAD</references>
        <references refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390a1226b6b09205a355fda355296110d6e0" compoundref="ckernel__kernel__specs_8h" startline="18">CK_DIM_ALIGNED_INTERMEDIATE</references>
        <references refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390ae3642cb3cf04f4cfb52b4ede9841f93c" compoundref="ckernel__kernel__specs_8h" startline="10">CK_DIM_EMBED</references>
        <references refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390a5b77bd8d985c0ad98814cdc0fe4c486d" compoundref="ckernel__kernel__specs_8h" startline="20">CK_DIM_END</references>
        <references refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390a93c285e641a7b5adf02ab5789bd6c67e" compoundref="ckernel__kernel__specs_8h" startline="12">CK_DIM_HEAD_DIM</references>
        <references refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390a3ad2a6283747a86588d92626a007a966" compoundref="ckernel__kernel__specs_8h" startline="17">CK_DIM_INTERMEDIATE</references>
        <references refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390a167927f2a71ef59e9f845da2a9daf455" compoundref="ckernel__kernel__specs_8h" startline="14">CK_DIM_NUM_HEADS</references>
        <references refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390ac30adce7339623b8eff35dcce54cab73" compoundref="ckernel__kernel__specs_8h" startline="15">CK_DIM_NUM_KV_HEADS</references>
        <references refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390a366fb4213b618a2f19d10fcfadc3c7a9" compoundref="ckernel__kernel__specs_8h" startline="9">CK_DIM_TOKENS</references>
        <references refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390ad3c65bca8b153801fe0f40a0b7228759" compoundref="ckernel__kernel__specs_8h" startline="19">CK_DIM_VOCAB</references>
        <references refid="structCKModelConfig_1a18a327829d25405e92ba46a79009b89f" compoundref="ckernel__ir_8h" startline="30">CKModelConfig::context_window</references>
        <references refid="structCKModelConfig_1afd04ffe4db48600b90f32904c49d73af" compoundref="ckernel__ir_8h" startline="25">CKModelConfig::hidden_size</references>
        <references refid="structCKModelConfig_1a2da9b0b988ccf3b7117a611da5984d34" compoundref="ckernel__ir_8h" startline="26">CKModelConfig::intermediate_size</references>
        <references refid="structCKModelConfig_1a3e5c8e6d2da07805365ec6b4db29b9ea" compoundref="ckernel__ir_8h" startline="27">CKModelConfig::num_heads</references>
        <references refid="structCKModelConfig_1a902b19335449fa61c1e532d9999aa342" compoundref="ckernel__ir_8h" startline="28">CKModelConfig::num_kv_heads</references>
        <references refid="structCKModelConfig_1ad2b6c5944307859fe26f4d915d089027" compoundref="ckernel__ir_8h" startline="29">CKModelConfig::vocab_size</references>
        <referencedby refid="ckernel__mem__plan_8c_1a1a08695b8f684d75f5a5e8ac277da6f9" compoundref="ckernel__mem__plan_8c" startline="65" endline="82">resolve_shape_elems</referencedby>
      </memberdef>
      <memberdef kind="function" id="ckernel__mem__plan_8c_1a1a08695b8f684d75f5a5e8ac277da6f9" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>size_t</type>
        <definition>static size_t resolve_shape_elems</definition>
        <argsstring>(const CKModelConfig *cfg, const CKIRV2AlignInfo *align, const CKDimToken *shape, int tokens_override)</argsstring>
        <name>resolve_shape_elems</name>
        <param>
          <type>const <ref refid="structCKModelConfig" kindref="compound">CKModelConfig</ref> *</type>
          <declname>cfg</declname>
        </param>
        <param>
          <type>const CKIRV2AlignInfo *</type>
          <declname>align</declname>
        </param>
        <param>
          <type>const <ref refid="structCKDimToken" kindref="compound">CKDimToken</ref> *</type>
          <declname>shape</declname>
        </param>
        <param>
          <type>int</type>
          <declname>tokens_override</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/antshiv/Workspace/C-Kernel-Engine/src/ckernel_mem_plan.c" line="65" column="15" bodyfile="/home/antshiv/Workspace/C-Kernel-Engine/src/ckernel_mem_plan.c" bodystart="65" bodyend="82"/>
        <references refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390a5b77bd8d985c0ad98814cdc0fe4c486d" compoundref="ckernel__kernel__specs_8h" startline="20">CK_DIM_END</references>
        <references refid="ckernel__ir__v2_8h_1a058176b4def706d5a0e1e2e37f472ede" compoundref="ckernel__ir__v2_8h" startline="13">CK_IR_V2_MAX_DIMS</references>
        <references refid="ckernel__mem__plan_8c_1a0d9ae71bc7bcfb4654c4c2c5bdaf8e4e" compoundref="ckernel__mem__plan_8c" startline="28" endline="63">resolve_dim</references>
        <referencedby refid="ckernel__mem__plan_8c_1a2ac35f81413e92025c1492d78f45a703" compoundref="ckernel__mem__plan_8c" startline="146" endline="214">build_plan</referencedby>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="preprocessor">#include<sp/>&quot;<ref refid="ckernel__mem__plan_8h" kindref="compound">ckernel_mem_plan.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="ckernel__dtype_8h" kindref="compound">ckernel_dtype.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdlib.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;string.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="9"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>aligned_embed;</highlight></codeline>
<codeline lineno="10"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>aligned_head;</highlight></codeline>
<codeline lineno="11"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>aligned_intermediate;</highlight></codeline>
<codeline lineno="12"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>aligned_context;</highlight></codeline>
<codeline lineno="13"><highlight class="normal">}<sp/>CKIRV2AlignInfo;</highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight></codeline>
<codeline lineno="15" refid="ckernel__mem__plan_8c_1a19108c1ddea653d46840daefcf542bb5" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/><ref refid="ckernel__mem__plan_8c_1a19108c1ddea653d46840daefcf542bb5" kindref="member">align_up_bytes</ref>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>align)</highlight></codeline>
<codeline lineno="16"><highlight class="normal">{</highlight></codeline>
<codeline lineno="17"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(align<sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>n;</highlight></codeline>
<codeline lineno="18"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(n<sp/>+<sp/>align<sp/>-<sp/>1)<sp/>&amp;<sp/>~(align<sp/>-<sp/>1);</highlight></codeline>
<codeline lineno="19"><highlight class="normal">}</highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight></codeline>
<codeline lineno="21" refid="ckernel__mem__plan_8c_1a1a43f9f3bcd4506c4f8c237af70f0a04" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/><ref refid="ckernel__mem__plan_8c_1a1a43f9f3bcd4506c4f8c237af70f0a04" kindref="member">align_up_elems</ref>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>elems,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>elem_bytes,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>align_bytes)</highlight></codeline>
<codeline lineno="22"><highlight class="normal">{</highlight></codeline>
<codeline lineno="23"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>bytes<sp/>=<sp/>elems<sp/>*<sp/>elem_bytes;</highlight></codeline>
<codeline lineno="24"><highlight class="normal"><sp/><sp/><sp/><sp/>bytes<sp/>=<sp/><ref refid="ckernel__mem__plan_8c_1a19108c1ddea653d46840daefcf542bb5" kindref="member">align_up_bytes</ref>(bytes,<sp/>align_bytes);</highlight></codeline>
<codeline lineno="25"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>bytes<sp/>/<sp/>elem_bytes;</highlight></codeline>
<codeline lineno="26"><highlight class="normal">}</highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight></codeline>
<codeline lineno="28" refid="ckernel__mem__plan_8c_1a0d9ae71bc7bcfb4654c4c2c5bdaf8e4e" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/><ref refid="ckernel__mem__plan_8c_1a0d9ae71bc7bcfb4654c4c2c5bdaf8e4e" kindref="member">resolve_dim</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structCKModelConfig" kindref="compound">CKModelConfig</ref><sp/>*cfg,</highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>CKIRV2AlignInfo<sp/>*align,</highlight></codeline>
<codeline lineno="30"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390" kindref="member">CKDimKind</ref><sp/>kind,</highlight></codeline>
<codeline lineno="31"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>tokens_override)</highlight></codeline>
<codeline lineno="32"><highlight class="normal">{</highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(kind)<sp/>{</highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390a366fb4213b618a2f19d10fcfadc3c7a9" kindref="member">CK_DIM_TOKENS</ref>:</highlight></codeline>
<codeline lineno="35"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(tokens_override<sp/>&gt;=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)tokens_override;</highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)cfg-&gt;<ref refid="structCKModelConfig_1a18a327829d25405e92ba46a79009b89f" kindref="member">context_window</ref>;</highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390ae3642cb3cf04f4cfb52b4ede9841f93c" kindref="member">CK_DIM_EMBED</ref>:</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)cfg-&gt;<ref refid="structCKModelConfig_1afd04ffe4db48600b90f32904c49d73af" kindref="member">hidden_size</ref>;</highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390a29f29d6e4d6a83d51a84464caf90b5ad" kindref="member">CK_DIM_ALIGNED_EMBED</ref>:</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>align-&gt;aligned_embed;</highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390a93c285e641a7b5adf02ab5789bd6c67e" kindref="member">CK_DIM_HEAD_DIM</ref>:</highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)(cfg-&gt;<ref refid="structCKModelConfig_1afd04ffe4db48600b90f32904c49d73af" kindref="member">hidden_size</ref><sp/>/<sp/>cfg-&gt;<ref refid="structCKModelConfig_1a3e5c8e6d2da07805365ec6b4db29b9ea" kindref="member">num_heads</ref>);</highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390a89205855111843486cea0674ca1472bb" kindref="member">CK_DIM_ALIGNED_HEAD</ref>:</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>align-&gt;aligned_head;</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390a167927f2a71ef59e9f845da2a9daf455" kindref="member">CK_DIM_NUM_HEADS</ref>:</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)cfg-&gt;<ref refid="structCKModelConfig_1a3e5c8e6d2da07805365ec6b4db29b9ea" kindref="member">num_heads</ref>;</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390ac30adce7339623b8eff35dcce54cab73" kindref="member">CK_DIM_NUM_KV_HEADS</ref>:</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)cfg-&gt;<ref refid="structCKModelConfig_1a902b19335449fa61c1e532d9999aa342" kindref="member">num_kv_heads</ref>;</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390a3cdb63a663d3f19f1d2d9aeb8c124a38" kindref="member">CK_DIM_ALIGNED_CTX</ref>:</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>align-&gt;aligned_context;</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390a3ad2a6283747a86588d92626a007a966" kindref="member">CK_DIM_INTERMEDIATE</ref>:</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)cfg-&gt;<ref refid="structCKModelConfig_1a2da9b0b988ccf3b7117a611da5984d34" kindref="member">intermediate_size</ref>;</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390a1226b6b09205a355fda355296110d6e0" kindref="member">CK_DIM_ALIGNED_INTERMEDIATE</ref>:</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>align-&gt;aligned_intermediate;</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390ad3c65bca8b153801fe0f40a0b7228759" kindref="member">CK_DIM_VOCAB</ref>:</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)cfg-&gt;<ref refid="structCKModelConfig_1ad2b6c5944307859fe26f4d915d089027" kindref="member">vocab_size</ref>;</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390a5b77bd8d985c0ad98814cdc0fe4c486d" kindref="member">CK_DIM_END</ref>:</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="63"><highlight class="normal">}</highlight></codeline>
<codeline lineno="64"><highlight class="normal"></highlight></codeline>
<codeline lineno="65" refid="ckernel__mem__plan_8c_1a1a08695b8f684d75f5a5e8ac277da6f9" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/><ref refid="ckernel__mem__plan_8c_1a1a08695b8f684d75f5a5e8ac277da6f9" kindref="member">resolve_shape_elems</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structCKModelConfig" kindref="compound">CKModelConfig</ref><sp/>*cfg,</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>CKIRV2AlignInfo<sp/>*align,</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structCKDimToken" kindref="compound">CKDimToken</ref><sp/>*shape,</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>tokens_override)</highlight></codeline>
<codeline lineno="69"><highlight class="normal">{</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>total<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="ckernel__ir__v2_8h_1a058176b4def706d5a0e1e2e37f472ede" kindref="member">CK_IR_V2_MAX_DIMS</ref>;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(shape[i].dim<sp/>==<sp/><ref refid="ckernel__kernel__specs_8h_1a3d91eb22ec223e36c65a04283581e390a5b77bd8d985c0ad98814cdc0fe4c486d" kindref="member">CK_DIM_END</ref>)<sp/>{</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>dim<sp/>=<sp/><ref refid="ckernel__mem__plan_8c_1a0d9ae71bc7bcfb4654c4c2c5bdaf8e4e" kindref="member">resolve_dim</ref>(cfg,<sp/>align,<sp/>shape[i].dim,<sp/>tokens_override);</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>mult<sp/>=<sp/>(size_t)(shape[i].mult<sp/>&gt;<sp/>0<sp/>?<sp/>shape[i].mult<sp/>:<sp/>1);</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>div<sp/>=<sp/>(size_t)(shape[i].div<sp/>&gt;<sp/>0<sp/>?<sp/>shape[i].div<sp/>:<sp/>1);</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(div<sp/>==<sp/>0)<sp/>div<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>total<sp/>=<sp/>total<sp/>*<sp/>dim<sp/>*<sp/>mult<sp/>/<sp/>div;</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>total;</highlight></codeline>
<codeline lineno="82"><highlight class="normal">}</highlight></codeline>
<codeline lineno="83"><highlight class="normal"></highlight></codeline>
<codeline lineno="84" refid="ckernel__mem__plan_8c_1a648ff92cf8d5c0cc9cd28c3b4567a6a6" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="ckernel__mem__plan_8h_1a7593aeefed160055e5352bda2cb27873" kindref="member">CKMemArenaKind</ref><sp/><ref refid="ckernel__mem__plan_8c_1a648ff92cf8d5c0cc9cd28c3b4567a6a6" kindref="member">arena_for_role</ref>(<ref refid="ckernel__kernel__specs_8h_1a1c2c408a04c891ae526f5d909d0c8401" kindref="member">CKBufferRole</ref><sp/>role)</highlight></codeline>
<codeline lineno="85"><highlight class="normal">{</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(role)<sp/>{</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="ckernel__kernel__specs_8h_1a1c2c408a04c891ae526f5d909d0c8401a1e808475314280ece78fbbfa6aec27c6" kindref="member">CK_ROLE_WEIGHT</ref>:</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ckernel__mem__plan_8h_1a7593aeefed160055e5352bda2cb27873a904b7e65d05595093e2c5ed58578a3be" kindref="member">CK_MEM_ARENA_WEIGHTS</ref>;</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="ckernel__kernel__specs_8h_1a1c2c408a04c891ae526f5d909d0c8401a9812ba1491a1ec75f2d2a186de1fe806" kindref="member">CK_ROLE_GRAD</ref>:</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ckernel__mem__plan_8h_1a7593aeefed160055e5352bda2cb27873a32ad00dbbce0c0eb6486d21de6a43492" kindref="member">CK_MEM_ARENA_GRADS</ref>;</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="ckernel__kernel__specs_8h_1a1c2c408a04c891ae526f5d909d0c8401a8fbf92f873c30e7522e194bb8e936041" kindref="member">CK_ROLE_SCRATCH</ref>:</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="ckernel__kernel__specs_8h_1a1c2c408a04c891ae526f5d909d0c8401ada6ca31e0365c782ee073e91f8516bea" kindref="member">CK_ROLE_ACTIVATION</ref>:</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="ckernel__kernel__specs_8h_1a1c2c408a04c891ae526f5d909d0c8401af78578048797064d7f8b235c8393e39f" kindref="member">CK_ROLE_INPUT</ref>:</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="ckernel__kernel__specs_8h_1a1c2c408a04c891ae526f5d909d0c8401afbfc5f2a6199ecf56c8d3ccd4b4145fa" kindref="member">CK_ROLE_OUTPUT</ref>:</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ckernel__mem__plan_8h_1a7593aeefed160055e5352bda2cb27873ab440f0630c9e4a2b22f79b82e76699f0" kindref="member">CK_MEM_ARENA_ACTIVATIONS</ref>;</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="98"><highlight class="normal">}</highlight></codeline>
<codeline lineno="99"><highlight class="normal"></highlight></codeline>
<codeline lineno="100" refid="ckernel__mem__plan_8c_1abb79ec65608b1997ebc6ee5983c24504" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="ckernel__mem__plan_8c_1abb79ec65608b1997ebc6ee5983c24504" kindref="member">buffer_enabled</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structCKIRV2Graph" kindref="compound">CKIRV2Graph</ref><sp/>*graph,</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structCKIRV2Buffer" kindref="compound">CKIRV2Buffer</ref><sp/>*buf,</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>training_enabled)</highlight></codeline>
<codeline lineno="103"><highlight class="normal">{</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!graph<sp/>||<sp/>!buf)<sp/>{</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(buf-&gt;<ref refid="structCKIRV2Buffer_1a50f6cc398851b0c231520444e855113b" kindref="member">condition</ref><sp/>&amp;&amp;<sp/>strcmp(buf-&gt;<ref refid="structCKIRV2Buffer_1a50f6cc398851b0c231520444e855113b" kindref="member">condition</ref>,<sp/></highlight><highlight class="stringliteral">&quot;rope_theta&quot;</highlight><highlight class="normal">)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(graph-&gt;<ref refid="structCKIRV2Graph_1a49f1785b410e7bcae526d0b1dec440f3" kindref="member">config</ref>.<ref refid="structCKModelConfig_1ae7ab37061b5249887af28ef7eb481377" kindref="member">rope_theta</ref><sp/>&lt;=<sp/>0.0f)<sp/>{</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(buf-&gt;<ref refid="structCKIRV2Buffer_1a50f6cc398851b0c231520444e855113b" kindref="member">condition</ref><sp/>&amp;&amp;<sp/>strcmp(buf-&gt;<ref refid="structCKIRV2Buffer_1a50f6cc398851b0c231520444e855113b" kindref="member">condition</ref>,<sp/></highlight><highlight class="stringliteral">&quot;rope_disabled&quot;</highlight><highlight class="normal">)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(graph-&gt;<ref refid="structCKIRV2Graph_1a49f1785b410e7bcae526d0b1dec440f3" kindref="member">config</ref>.<ref refid="structCKModelConfig_1ae7ab37061b5249887af28ef7eb481377" kindref="member">rope_theta</ref><sp/>&gt;<sp/>0.0f)<sp/>{</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(buf-&gt;<ref refid="structCKIRV2Buffer_1a50f6cc398851b0c231520444e855113b" kindref="member">condition</ref><sp/>&amp;&amp;<sp/>strcmp(buf-&gt;<ref refid="structCKIRV2Buffer_1a50f6cc398851b0c231520444e855113b" kindref="member">condition</ref>,<sp/></highlight><highlight class="stringliteral">&quot;has_pos_emb&quot;</highlight><highlight class="normal">)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(graph-&gt;<ref refid="structCKIRV2Graph_1a520e755b859ef64a2f7299c9472e9911" kindref="member">has_pos_emb</ref><sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(buf-&gt;<ref refid="structCKIRV2Buffer_1a50f6cc398851b0c231520444e855113b" kindref="member">condition</ref><sp/>&amp;&amp;<sp/>strcmp(buf-&gt;<ref refid="structCKIRV2Buffer_1a50f6cc398851b0c231520444e855113b" kindref="member">condition</ref>,<sp/></highlight><highlight class="stringliteral">&quot;training_enabled&quot;</highlight><highlight class="normal">)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!training_enabled)<sp/>{</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(buf-&gt;<ref refid="structCKIRV2Buffer_1a3c077f1f0bdfd4b832a17aea56c823d1" kindref="member">role</ref><sp/>==<sp/><ref refid="ckernel__kernel__specs_8h_1a1c2c408a04c891ae526f5d909d0c8401a9812ba1491a1ec75f2d2a186de1fe806" kindref="member">CK_ROLE_GRAD</ref><sp/>&amp;&amp;<sp/>!training_enabled)<sp/>{</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="131"><highlight class="normal">}</highlight></codeline>
<codeline lineno="132"><highlight class="normal"></highlight></codeline>
<codeline lineno="133" refid="ckernel__mem__plan_8c_1a615c5d3cfa93ae333a302f9c14b4927c" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="ckernel__mem__plan_8c_1a615c5d3cfa93ae333a302f9c14b4927c" kindref="member">find_buffer_by_name</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structCKIRV2Graph" kindref="compound">CKIRV2Graph</ref><sp/>*graph,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*name)</highlight></codeline>
<codeline lineno="134"><highlight class="normal">{</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!graph<sp/>||<sp/>!name)<sp/>{</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>graph-&gt;<ref refid="structCKIRV2Graph_1aeb72a3027aef579daf9a4ac090ac71ba" kindref="member">num_buffers</ref>;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(graph-&gt;<ref refid="structCKIRV2Graph_1ad2d61568dda8232b3252da14a53ffc03" kindref="member">buffers</ref>[i].<ref refid="structCKIRV2Buffer_1a2f431336505aa19000ed2535be85bc71" kindref="member">name</ref><sp/>&amp;&amp;<sp/>strcmp(graph-&gt;<ref refid="structCKIRV2Graph_1ad2d61568dda8232b3252da14a53ffc03" kindref="member">buffers</ref>[i].<ref refid="structCKIRV2Buffer_1a2f431336505aa19000ed2535be85bc71" kindref="member">name</ref>,<sp/>name)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="144"><highlight class="normal">}</highlight></codeline>
<codeline lineno="145"><highlight class="normal"></highlight></codeline>
<codeline lineno="146" refid="ckernel__mem__plan_8c_1a2ac35f81413e92025c1492d78f45a703" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="ckernel__mem__plan_8c_1a2ac35f81413e92025c1492d78f45a703" kindref="member">build_plan</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structCKIRV2Graph" kindref="compound">CKIRV2Graph</ref><sp/>*graph,</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structCKMemPlan" kindref="compound">CKMemPlan</ref><sp/>*plan,</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>alignment_bytes,</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>training_enabled,</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>tokens_override)</highlight></codeline>
<codeline lineno="151"><highlight class="normal">{</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!graph<sp/>||<sp/>!plan)<sp/>{</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/>memset(plan,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*plan));</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(alignment_bytes<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>alignment_bytes<sp/>=<sp/><ref refid="ckernel__mem__plan_8h_1a7b0ecac54309914511507bc80cdce744" kindref="member">CK_MEM_PLAN_DEFAULT_ALIGN</ref>;</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/>plan-&gt;<ref refid="structCKMemPlan_1a8e5e24bcf347c4fe2d45e76be8c2351e" kindref="member">alignment_bytes</ref><sp/>=<sp/>alignment_bytes;</highlight></codeline>
<codeline lineno="160"><highlight class="normal"></highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/>plan-&gt;<ref refid="structCKMemPlan_1a7c1dd8cbe777a1f0a40af32a417fdc37" kindref="member">num_spans</ref><sp/>=<sp/>graph-&gt;<ref refid="structCKIRV2Graph_1aeb72a3027aef579daf9a4ac090ac71ba" kindref="member">num_buffers</ref>;</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/>plan-&gt;<ref refid="structCKMemPlan_1a2eafa236d6d9a88944d798cdbd43737d" kindref="member">spans</ref><sp/>=<sp/>(<ref refid="structCKMemSpan" kindref="compound">CKMemSpan</ref><sp/>*)calloc((</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)graph-&gt;<ref refid="structCKIRV2Graph_1aeb72a3027aef579daf9a4ac090ac71ba" kindref="member">num_buffers</ref>,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="structCKMemSpan" kindref="compound">CKMemSpan</ref>));</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!plan-&gt;<ref refid="structCKMemPlan_1a2eafa236d6d9a88944d798cdbd43737d" kindref="member">spans</ref>)<sp/>{</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="166"><highlight class="normal"></highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>elem_bytes<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(float);</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/>CKIRV2AlignInfo<sp/>align<sp/>=<sp/>{0};</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/>align.aligned_embed<sp/>=<sp/><ref refid="ckernel__mem__plan_8c_1a1a43f9f3bcd4506c4f8c237af70f0a04" kindref="member">align_up_elems</ref>((</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)graph-&gt;<ref refid="structCKIRV2Graph_1a49f1785b410e7bcae526d0b1dec440f3" kindref="member">config</ref>.<ref refid="structCKModelConfig_1afd04ffe4db48600b90f32904c49d73af" kindref="member">hidden_size</ref>,<sp/>elem_bytes,<sp/>alignment_bytes);</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/>align.aligned_head<sp/>=<sp/><ref refid="ckernel__mem__plan_8c_1a1a43f9f3bcd4506c4f8c237af70f0a04" kindref="member">align_up_elems</ref>((</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)(graph-&gt;<ref refid="structCKIRV2Graph_1a49f1785b410e7bcae526d0b1dec440f3" kindref="member">config</ref>.<ref refid="structCKModelConfig_1afd04ffe4db48600b90f32904c49d73af" kindref="member">hidden_size</ref><sp/>/<sp/>graph-&gt;<ref refid="structCKIRV2Graph_1a49f1785b410e7bcae526d0b1dec440f3" kindref="member">config</ref>.<ref refid="structCKModelConfig_1a3e5c8e6d2da07805365ec6b4db29b9ea" kindref="member">num_heads</ref>),</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>elem_bytes,<sp/>alignment_bytes);</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/>align.aligned_intermediate<sp/>=<sp/><ref refid="ckernel__mem__plan_8c_1a1a43f9f3bcd4506c4f8c237af70f0a04" kindref="member">align_up_elems</ref>((</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)graph-&gt;<ref refid="structCKIRV2Graph_1a49f1785b410e7bcae526d0b1dec440f3" kindref="member">config</ref>.<ref refid="structCKModelConfig_1a2da9b0b988ccf3b7117a611da5984d34" kindref="member">intermediate_size</ref>,</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>elem_bytes,<sp/>alignment_bytes);</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/>align.aligned_context<sp/>=<sp/><ref refid="ckernel__mem__plan_8c_1a1a43f9f3bcd4506c4f8c237af70f0a04" kindref="member">align_up_elems</ref>((</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)graph-&gt;<ref refid="structCKIRV2Graph_1a49f1785b410e7bcae526d0b1dec440f3" kindref="member">config</ref>.<ref refid="structCKModelConfig_1a18a327829d25405e92ba46a79009b89f" kindref="member">context_window</ref>,<sp/>elem_bytes,<sp/>alignment_bytes);</highlight></codeline>
<codeline lineno="175"><highlight class="normal"></highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>arena_offsets[<ref refid="ckernel__mem__plan_8h_1a7593aeefed160055e5352bda2cb27873a8f8f213ffa426f0656a6de5c1fae8fbb" kindref="member">CK_MEM_ARENA_COUNT</ref>]<sp/>=<sp/>{0};</highlight></codeline>
<codeline lineno="177"><highlight class="normal"></highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>graph-&gt;<ref refid="structCKIRV2Graph_1aeb72a3027aef579daf9a4ac090ac71ba" kindref="member">num_buffers</ref>;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structCKIRV2Buffer" kindref="compound">CKIRV2Buffer</ref><sp/>*buf<sp/>=<sp/>&amp;graph-&gt;<ref refid="structCKIRV2Graph_1ad2d61568dda8232b3252da14a53ffc03" kindref="member">buffers</ref>[i];</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structCKMemSpan" kindref="compound">CKMemSpan</ref><sp/>*span<sp/>=<sp/>&amp;plan-&gt;<ref refid="structCKMemPlan_1a2eafa236d6d9a88944d798cdbd43737d" kindref="member">spans</ref>[i];</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>span-&gt;<ref refid="structCKMemSpan_1a0d967f0eca56cf7113b4552d67b208e5" kindref="member">buffer_id</ref><sp/>=<sp/>i;</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>span-&gt;<ref refid="structCKMemSpan_1a818835e50806e8d1fd141cf97b4ea806" kindref="member">arena</ref><sp/>=<sp/><ref refid="ckernel__mem__plan_8c_1a648ff92cf8d5c0cc9cd28c3b4567a6a6" kindref="member">arena_for_role</ref>(buf-&gt;<ref refid="structCKIRV2Buffer_1a3c077f1f0bdfd4b832a17aea56c823d1" kindref="member">role</ref>);</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>span-&gt;<ref refid="structCKMemSpan_1af281883bfadbea82697819bbf12aa759" kindref="member">offset_bytes</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>span-&gt;<ref refid="structCKMemSpan_1a1a8d564452e900aa6e0978ac20b63c5e" kindref="member">size_bytes</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="185"><highlight class="normal"></highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="ckernel__mem__plan_8c_1abb79ec65608b1997ebc6ee5983c24504" kindref="member">buffer_enabled</ref>(graph,<sp/>buf,<sp/>training_enabled))<sp/>{</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="189"><highlight class="normal"></highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(buf-&gt;<ref refid="structCKIRV2Buffer_1a92f6356a2149550923b521d604bc9486" kindref="member">alias_of</ref>)<sp/>{</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>alias_id<sp/>=<sp/><ref refid="ckernel__mem__plan_8c_1a615c5d3cfa93ae333a302f9c14b4927c" kindref="member">find_buffer_by_name</ref>(graph,<sp/>buf-&gt;<ref refid="structCKIRV2Buffer_1a92f6356a2149550923b521d604bc9486" kindref="member">alias_of</ref>);</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(alias_id<sp/>&gt;=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>span-&gt;<ref refid="structCKMemSpan_1af281883bfadbea82697819bbf12aa759" kindref="member">offset_bytes</ref><sp/>=<sp/>plan-&gt;<ref refid="structCKMemPlan_1a2eafa236d6d9a88944d798cdbd43737d" kindref="member">spans</ref>[alias_id].<ref refid="structCKMemSpan_1af281883bfadbea82697819bbf12aa759" kindref="member">offset_bytes</ref>;</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>span-&gt;<ref refid="structCKMemSpan_1a1a8d564452e900aa6e0978ac20b63c5e" kindref="member">size_bytes</ref><sp/>=<sp/>plan-&gt;<ref refid="structCKMemPlan_1a2eafa236d6d9a88944d798cdbd43737d" kindref="member">spans</ref>[alias_id].<ref refid="structCKMemSpan_1a1a8d564452e900aa6e0978ac20b63c5e" kindref="member">size_bytes</ref>;</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>span-&gt;<ref refid="structCKMemSpan_1a818835e50806e8d1fd141cf97b4ea806" kindref="member">arena</ref><sp/>=<sp/>plan-&gt;<ref refid="structCKMemPlan_1a2eafa236d6d9a88944d798cdbd43737d" kindref="member">spans</ref>[alias_id].<ref refid="structCKMemSpan_1a818835e50806e8d1fd141cf97b4ea806" kindref="member">arena</ref>;</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="199"><highlight class="normal"></highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n_elems<sp/>=<sp/><ref refid="ckernel__mem__plan_8c_1a1a08695b8f684d75f5a5e8ac277da6f9" kindref="member">resolve_shape_elems</ref>(&amp;graph-&gt;<ref refid="structCKIRV2Graph_1a49f1785b410e7bcae526d0b1dec440f3" kindref="member">config</ref>,<sp/>&amp;align,<sp/>buf-&gt;<ref refid="structCKIRV2Buffer_1a22f159608ef2fbcdfdd84704ae3f5da4" kindref="member">shape</ref>,<sp/>tokens_override);</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>bytes<sp/>=<sp/><ref refid="ckernel__dtype_8h_1afb7fc50f1a3ed20ee55989027c744c8f" kindref="member">ck_dtype_row_bytes</ref>(buf-&gt;<ref refid="structCKIRV2Buffer_1acb1dc8a19c8fad476e89ab40bd6d31bf" kindref="member">dtype</ref>,<sp/>n_elems);</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>aligned<sp/>=<sp/><ref refid="ckernel__mem__plan_8c_1a19108c1ddea653d46840daefcf542bb5" kindref="member">align_up_bytes</ref>(bytes,<sp/>alignment_bytes);</highlight></codeline>
<codeline lineno="203"><highlight class="normal"></highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>span-&gt;<ref refid="structCKMemSpan_1af281883bfadbea82697819bbf12aa759" kindref="member">offset_bytes</ref><sp/>=<sp/>arena_offsets[span-&gt;<ref refid="structCKMemSpan_1a818835e50806e8d1fd141cf97b4ea806" kindref="member">arena</ref>];</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>span-&gt;<ref refid="structCKMemSpan_1a1a8d564452e900aa6e0978ac20b63c5e" kindref="member">size_bytes</ref><sp/>=<sp/>bytes;</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>arena_offsets[span-&gt;<ref refid="structCKMemSpan_1a818835e50806e8d1fd141cf97b4ea806" kindref="member">arena</ref>]<sp/>+=<sp/>aligned;</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="208"><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="ckernel__mem__plan_8h_1a7593aeefed160055e5352bda2cb27873a8f8f213ffa426f0656a6de5c1fae8fbb" kindref="member">CK_MEM_ARENA_COUNT</ref>;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plan-&gt;<ref refid="structCKMemPlan_1aa2e911b6ed9b128563d25bc6cec958d8" kindref="member">total_bytes</ref>[i]<sp/>=<sp/>arena_offsets[i];</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="212"><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="214"><highlight class="normal">}</highlight></codeline>
<codeline lineno="215"><highlight class="normal"></highlight></codeline>
<codeline lineno="216" refid="ckernel__mem__plan_8h_1a92e5aeb38254a89e211012c7cfa1886c" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="ckernel__mem__plan_8c_1a92e5aeb38254a89e211012c7cfa1886c" kindref="member">ck_mem_plan_build_inference</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structCKIRV2Graph" kindref="compound">CKIRV2Graph</ref><sp/>*graph,</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structCKMemPlan" kindref="compound">CKMemPlan</ref><sp/>*plan,</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>alignment_bytes)</highlight></codeline>
<codeline lineno="219"><highlight class="normal">{</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ckernel__mem__plan_8c_1a2ac35f81413e92025c1492d78f45a703" kindref="member">build_plan</ref>(graph,<sp/>plan,<sp/>alignment_bytes,<sp/>0,<sp/>-1);</highlight></codeline>
<codeline lineno="221"><highlight class="normal">}</highlight></codeline>
<codeline lineno="222"><highlight class="normal"></highlight></codeline>
<codeline lineno="223" refid="ckernel__mem__plan_8h_1a14f34bf1cb156c5a07296e5328f5c0cc" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="ckernel__mem__plan_8c_1a14f34bf1cb156c5a07296e5328f5c0cc" kindref="member">ck_mem_plan_build_training</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structCKIRV2Graph" kindref="compound">CKIRV2Graph</ref><sp/>*graph,</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structCKMemPlan" kindref="compound">CKMemPlan</ref><sp/>*plan,</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>alignment_bytes)</highlight></codeline>
<codeline lineno="226"><highlight class="normal">{</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ckernel__mem__plan_8c_1a2ac35f81413e92025c1492d78f45a703" kindref="member">build_plan</ref>(graph,<sp/>plan,<sp/>alignment_bytes,<sp/>1,<sp/>-1);</highlight></codeline>
<codeline lineno="228"><highlight class="normal">}</highlight></codeline>
<codeline lineno="229"><highlight class="normal"></highlight></codeline>
<codeline lineno="230" refid="ckernel__mem__plan_8h_1ab2ccd14ce31d7ef0d57d5620a96a23f4" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="ckernel__mem__plan_8c_1ab2ccd14ce31d7ef0d57d5620a96a23f4" kindref="member">ck_mem_plan_build_inference_with_tokens</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structCKIRV2Graph" kindref="compound">CKIRV2Graph</ref><sp/>*graph,</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structCKMemPlan" kindref="compound">CKMemPlan</ref><sp/>*plan,</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>alignment_bytes,</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>tokens_override)</highlight></codeline>
<codeline lineno="234"><highlight class="normal">{</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ckernel__mem__plan_8c_1a2ac35f81413e92025c1492d78f45a703" kindref="member">build_plan</ref>(graph,<sp/>plan,<sp/>alignment_bytes,<sp/>0,<sp/>tokens_override);</highlight></codeline>
<codeline lineno="236"><highlight class="normal">}</highlight></codeline>
<codeline lineno="237"><highlight class="normal"></highlight></codeline>
<codeline lineno="238" refid="ckernel__mem__plan_8h_1a57db8942b533ff570008d5d04a9f7c1e" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="ckernel__mem__plan_8c_1a57db8942b533ff570008d5d04a9f7c1e" kindref="member">ck_mem_plan_build_training_with_tokens</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structCKIRV2Graph" kindref="compound">CKIRV2Graph</ref><sp/>*graph,</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structCKMemPlan" kindref="compound">CKMemPlan</ref><sp/>*plan,</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>alignment_bytes,</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>tokens_override)</highlight></codeline>
<codeline lineno="242"><highlight class="normal">{</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ckernel__mem__plan_8c_1a2ac35f81413e92025c1492d78f45a703" kindref="member">build_plan</ref>(graph,<sp/>plan,<sp/>alignment_bytes,<sp/>1,<sp/>tokens_override);</highlight></codeline>
<codeline lineno="244"><highlight class="normal">}</highlight></codeline>
<codeline lineno="245"><highlight class="normal"></highlight></codeline>
<codeline lineno="246" refid="ckernel__mem__plan_8h_1a69f7ae632754a94b1a227da5a6633fb1" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="ckernel__mem__plan_8c_1a69f7ae632754a94b1a227da5a6633fb1" kindref="member">ck_mem_plan_free</ref>(<ref refid="structCKMemPlan" kindref="compound">CKMemPlan</ref><sp/>*plan)</highlight></codeline>
<codeline lineno="247"><highlight class="normal">{</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!plan)<sp/>{</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/>free(plan-&gt;<ref refid="structCKMemPlan_1a2eafa236d6d9a88944d798cdbd43737d" kindref="member">spans</ref>);</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/>memset(plan,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*plan));</highlight></codeline>
<codeline lineno="253"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="/home/antshiv/Workspace/C-Kernel-Engine/src/ckernel_mem_plan.c"/>
  </compounddef>
</doxygen>
