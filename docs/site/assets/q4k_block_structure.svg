<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 700">
  <defs>
    <linearGradient id="blockGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#363636"/>
      <stop offset="100%" style="stop-color:#2a2a2a"/>
    </linearGradient>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <path d="M0,0 L0,6 L9,3 z" fill="#ffb400"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1200" height="700" fill="#1a1a1a"/>

  <!-- Title -->
  <text x="600" y="40" text-anchor="middle" fill="#ffffff" font-family="Inter, sans-serif" font-size="24" font-weight="700">Q4_K Block Structure: Nested Scales (256 Weights)</text>

  <!-- Subtitle -->
  <text x="600" y="70" text-anchor="middle" fill="#808080" font-family="Inter, sans-serif" font-size="14">144 bytes per 256 weights = 4.5 bits per weight</text>

  <!-- ===== Super Block Header ===== -->
  <rect x="50" y="100" width="1100" height="120" rx="8" fill="url(#blockGrad)" stroke="#9b59b6" stroke-width="3"/>
  <text x="600" y="125" text-anchor="middle" fill="#9b59b6" font-family="Inter, sans-serif" font-size="16" font-weight="700">Super-Block Header (16 bytes)</text>

  <!-- d (scale) -->
  <rect x="80" y="145" width="120" height="55" rx="4" fill="#9b59b6"/>
  <text x="140" y="170" text-anchor="middle" fill="#ffffff" font-family="JetBrains Mono, monospace" font-size="12" font-weight="600">d (FP16)</text>
  <text x="140" y="188" text-anchor="middle" fill="#ffffff" font-family="Inter, sans-serif" font-size="10">2 bytes</text>

  <!-- dmin (minimum) -->
  <rect x="220" y="145" width="120" height="55" rx="4" fill="#9b59b6"/>
  <text x="280" y="170" text-anchor="middle" fill="#ffffff" font-family="JetBrains Mono, monospace" font-size="12" font-weight="600">dmin (FP16)</text>
  <text x="280" y="188" text-anchor="middle" fill="#ffffff" font-family="Inter, sans-serif" font-size="10">2 bytes</text>

  <!-- scales[12] -->
  <rect x="360" y="145" width="760" height="55" rx="4" fill="#07adf8"/>
  <text x="740" y="165" text-anchor="middle" fill="#ffffff" font-family="JetBrains Mono, monospace" font-size="12" font-weight="600">scales[12] - Sub-block scales (6-bit each, packed)</text>
  <text x="740" y="185" text-anchor="middle" fill="#ffffff" font-family="Inter, sans-serif" font-size="10">12 bytes = 8 sub-block scales + 8 sub-block mins</text>

  <!-- Scale boxes inside -->
  <g transform="translate(380, 155)">
    <rect x="0" y="0" width="35" height="25" rx="2" fill="#0596d6"/>
    <text x="17" y="16" text-anchor="middle" fill="#fff" font-family="JetBrains Mono, monospace" font-size="8">sc0</text>
    <rect x="40" y="0" width="35" height="25" rx="2" fill="#0596d6"/>
    <text x="57" y="16" text-anchor="middle" fill="#fff" font-family="JetBrains Mono, monospace" font-size="8">sc1</text>
    <rect x="80" y="0" width="35" height="25" rx="2" fill="#0596d6"/>
    <text x="97" y="16" text-anchor="middle" fill="#fff" font-family="JetBrains Mono, monospace" font-size="8">sc2</text>
    <rect x="120" y="0" width="35" height="25" rx="2" fill="#0596d6"/>
    <text x="137" y="16" text-anchor="middle" fill="#fff" font-family="JetBrains Mono, monospace" font-size="8">sc3</text>
    <rect x="160" y="0" width="35" height="25" rx="2" fill="#0596d6"/>
    <text x="177" y="16" text-anchor="middle" fill="#fff" font-family="JetBrains Mono, monospace" font-size="8">sc4</text>
    <rect x="200" y="0" width="35" height="25" rx="2" fill="#0596d6"/>
    <text x="217" y="16" text-anchor="middle" fill="#fff" font-family="JetBrains Mono, monospace" font-size="8">sc5</text>
    <rect x="240" y="0" width="35" height="25" rx="2" fill="#0596d6"/>
    <text x="257" y="16" text-anchor="middle" fill="#fff" font-family="JetBrains Mono, monospace" font-size="8">sc6</text>
    <rect x="280" y="0" width="35" height="25" rx="2" fill="#0596d6"/>
    <text x="297" y="16" text-anchor="middle" fill="#fff" font-family="JetBrains Mono, monospace" font-size="8">sc7</text>
    <text x="340" y="16" fill="#b0b0b0" font-family="Inter, sans-serif" font-size="10">+ 8 mins</text>
  </g>

  <!-- ===== Quantized Weights ===== -->
  <rect x="50" y="240" width="1100" height="100" rx="8" fill="url(#blockGrad)" stroke="#ffb400" stroke-width="3"/>
  <text x="600" y="265" text-anchor="middle" fill="#ffb400" font-family="Inter, sans-serif" font-size="16" font-weight="700">qs[128] - Quantized Weights (128 bytes = 256 x 4-bit)</text>

  <!-- Weight nibble boxes -->
  <g transform="translate(80, 285)">
    <rect x="0" y="0" width="60" height="35" rx="3" fill="#e5a200"/>
    <text x="30" y="15" text-anchor="middle" fill="#1a1a1a" font-family="JetBrains Mono, monospace" font-size="9" font-weight="600">w0,w1</text>
    <text x="30" y="28" text-anchor="middle" fill="#1a1a1a" font-family="Inter, sans-serif" font-size="8">1 byte</text>
  </g>
  <g transform="translate(150, 285)">
    <rect x="0" y="0" width="60" height="35" rx="3" fill="#e5a200"/>
    <text x="30" y="15" text-anchor="middle" fill="#1a1a1a" font-family="JetBrains Mono, monospace" font-size="9" font-weight="600">w2,w3</text>
    <text x="30" y="28" text-anchor="middle" fill="#1a1a1a" font-family="Inter, sans-serif" font-size="8">1 byte</text>
  </g>
  <g transform="translate(220, 285)">
    <rect x="0" y="0" width="60" height="35" rx="3" fill="#e5a200"/>
    <text x="30" y="15" text-anchor="middle" fill="#1a1a1a" font-family="JetBrains Mono, monospace" font-size="9" font-weight="600">w4,w5</text>
    <text x="30" y="28" text-anchor="middle" fill="#1a1a1a" font-family="Inter, sans-serif" font-size="8">1 byte</text>
  </g>
  <text x="310" y="305" fill="#808080" font-family="Inter, sans-serif" font-size="14">...</text>
  <g transform="translate(340, 285)">
    <rect x="0" y="0" width="80" height="35" rx="3" fill="#e5a200"/>
    <text x="40" y="22" text-anchor="middle" fill="#1a1a1a" font-family="JetBrains Mono, monospace" font-size="9" font-weight="600">w254,w255</text>
  </g>

  <!-- Nibble detail -->
  <rect x="500" y="278" width="200" height="45" rx="4" fill="#2a2a2a" stroke="#ffb400" stroke-width="1"/>
  <text x="600" y="298" text-anchor="middle" fill="#ffb400" font-family="Inter, sans-serif" font-size="11" font-weight="600">Nibble Packing</text>
  <text x="600" y="315" text-anchor="middle" fill="#b0b0b0" font-family="JetBrains Mono, monospace" font-size="10">byte = (w_hi &lt;&lt; 4) | (w_lo &amp; 0xF)</text>

  <!-- Total bytes -->
  <rect x="750" y="278" width="150" height="45" rx="4" fill="#47b475"/>
  <text x="825" y="298" text-anchor="middle" fill="#ffffff" font-family="Inter, sans-serif" font-size="11" font-weight="600">Total: 144 bytes</text>
  <text x="825" y="315" text-anchor="middle" fill="#ffffff" font-family="Inter, sans-serif" font-size="10">16 + 128 = 144</text>

  <!-- ===== Sub-block Breakdown ===== -->
  <text x="600" y="380" text-anchor="middle" fill="#ffffff" font-family="Inter, sans-serif" font-size="18" font-weight="700">Sub-Block Structure (32 weights each)</text>

  <!-- Sub-block container -->
  <rect x="50" y="400" width="1100" height="140" rx="8" fill="#232323" stroke="#454545" stroke-width="2"/>

  <!-- 8 sub-blocks -->
  <g transform="translate(70, 420)">
    <!-- Sub-block 0 -->
    <rect x="0" y="0" width="125" height="100" rx="6" fill="#2a2a2a" stroke="#07adf8" stroke-width="2"/>
    <text x="62" y="20" text-anchor="middle" fill="#07adf8" font-family="Inter, sans-serif" font-size="11" font-weight="600">Sub-block 0</text>
    <rect x="10" y="30" width="105" height="25" rx="3" fill="#07adf8"/>
    <text x="62" y="48" text-anchor="middle" fill="#fff" font-family="JetBrains Mono, monospace" font-size="9">scale[0]</text>
    <rect x="10" y="60" width="105" height="30" rx="3" fill="#e5a200"/>
    <text x="62" y="80" text-anchor="middle" fill="#1a1a1a" font-family="JetBrains Mono, monospace" font-size="9">weights 0-31</text>

    <!-- Sub-block 1 -->
    <g transform="translate(135, 0)">
      <rect x="0" y="0" width="125" height="100" rx="6" fill="#2a2a2a" stroke="#07adf8" stroke-width="2"/>
      <text x="62" y="20" text-anchor="middle" fill="#07adf8" font-family="Inter, sans-serif" font-size="11" font-weight="600">Sub-block 1</text>
      <rect x="10" y="30" width="105" height="25" rx="3" fill="#07adf8"/>
      <text x="62" y="48" text-anchor="middle" fill="#fff" font-family="JetBrains Mono, monospace" font-size="9">scale[1]</text>
      <rect x="10" y="60" width="105" height="30" rx="3" fill="#e5a200"/>
      <text x="62" y="80" text-anchor="middle" fill="#1a1a1a" font-family="JetBrains Mono, monospace" font-size="9">weights 32-63</text>
    </g>

    <!-- Sub-block 2 -->
    <g transform="translate(270, 0)">
      <rect x="0" y="0" width="125" height="100" rx="6" fill="#2a2a2a" stroke="#07adf8" stroke-width="2"/>
      <text x="62" y="20" text-anchor="middle" fill="#07adf8" font-family="Inter, sans-serif" font-size="11" font-weight="600">Sub-block 2</text>
      <rect x="10" y="30" width="105" height="25" rx="3" fill="#07adf8"/>
      <text x="62" y="48" text-anchor="middle" fill="#fff" font-family="JetBrains Mono, monospace" font-size="9">scale[2]</text>
      <rect x="10" y="60" width="105" height="30" rx="3" fill="#e5a200"/>
      <text x="62" y="80" text-anchor="middle" fill="#1a1a1a" font-family="JetBrains Mono, monospace" font-size="9">weights 64-95</text>
    </g>

    <!-- Ellipsis -->
    <text x="430" y="55" fill="#808080" font-family="Inter, sans-serif" font-size="24">...</text>

    <!-- Sub-block 7 -->
    <g transform="translate(480, 0)">
      <rect x="0" y="0" width="125" height="100" rx="6" fill="#2a2a2a" stroke="#07adf8" stroke-width="2"/>
      <text x="62" y="20" text-anchor="middle" fill="#07adf8" font-family="Inter, sans-serif" font-size="11" font-weight="600">Sub-block 7</text>
      <rect x="10" y="30" width="105" height="25" rx="3" fill="#07adf8"/>
      <text x="62" y="48" text-anchor="middle" fill="#fff" font-family="JetBrains Mono, monospace" font-size="9">scale[7]</text>
      <rect x="10" y="60" width="105" height="30" rx="3" fill="#e5a200"/>
      <text x="62" y="80" text-anchor="middle" fill="#1a1a1a" font-family="JetBrains Mono, monospace" font-size="9">weights 224-255</text>
    </g>
  </g>

  <!-- Arrow showing hierarchy -->
  <g transform="translate(750, 420)">
    <rect x="0" y="0" width="280" height="100" rx="6" fill="#2a2a2a" stroke="#47b475" stroke-width="2"/>
    <text x="140" y="25" text-anchor="middle" fill="#47b475" font-family="Inter, sans-serif" font-size="13" font-weight="700">Dequantization Formula</text>
    <text x="140" y="50" text-anchor="middle" fill="#f5f5f5" font-family="JetBrains Mono, monospace" font-size="11">w_fp32 = q * (d * sc[i])</text>
    <text x="140" y="70" text-anchor="middle" fill="#f5f5f5" font-family="JetBrains Mono, monospace" font-size="11">         + dmin * min[i]</text>
    <text x="140" y="90" text-anchor="middle" fill="#808080" font-family="Inter, sans-serif" font-size="10">Two-level scaling for precision</text>
  </g>

  <!-- ===== Comparison Box ===== -->
  <rect x="50" y="560" width="540" height="120" rx="8" fill="#2a2a2a" stroke="#454545" stroke-width="2"/>
  <text x="320" y="590" text-anchor="middle" fill="#ffffff" font-family="Inter, sans-serif" font-size="14" font-weight="700">Q4_0 vs Q4_K Comparison</text>

  <text x="80" y="620" fill="#ffb400" font-family="Inter, sans-serif" font-size="12" font-weight="600">Q4_0:</text>
  <text x="150" y="620" fill="#b0b0b0" font-family="Inter, sans-serif" font-size="11">32 weights, 1 FP16 scale = 18 bytes (4.5 bpw)</text>

  <text x="80" y="645" fill="#47b475" font-family="Inter, sans-serif" font-size="12" font-weight="600">Q4_K:</text>
  <text x="150" y="645" fill="#b0b0b0" font-family="Inter, sans-serif" font-size="11">256 weights, hierarchical scales = 144 bytes (4.5 bpw)</text>

  <text x="80" y="670" fill="#07adf8" font-family="Inter, sans-serif" font-size="12" font-weight="600">Winner:</text>
  <text x="150" y="670" fill="#b0b0b0" font-family="Inter, sans-serif" font-size="11">Q4_K has better quality with same size!</text>

  <!-- ===== Key Insight ===== -->
  <rect x="610" y="560" width="540" height="120" rx="8" fill="#2a2a2a" stroke="#9b59b6" stroke-width="2"/>
  <text x="880" y="590" text-anchor="middle" fill="#9b59b6" font-family="Inter, sans-serif" font-size="14" font-weight="700">Why Hierarchical Scales?</text>

  <text x="640" y="620" fill="#b0b0b0" font-family="Inter, sans-serif" font-size="11">1. Super-block scale covers wide range (FP16 precision)</text>
  <text x="640" y="645" fill="#b0b0b0" font-family="Inter, sans-serif" font-size="11">2. Sub-block scales (6-bit) adapt to local variation</text>
  <text x="640" y="670" fill="#b0b0b0" font-family="Inter, sans-serif" font-size="11">3. Less overhead than per-32 FP16 scales</text>

  <!-- Legend -->
  <g transform="translate(50, 15)">
    <rect x="0" y="0" width="300" height="25" rx="4" fill="#2a2a2a"/>
    <rect x="10" y="5" width="15" height="15" rx="2" fill="#9b59b6"/>
    <text x="32" y="17" fill="#b0b0b0" font-family="Inter, sans-serif" font-size="10">Super-block</text>
    <rect x="100" y="5" width="15" height="15" rx="2" fill="#07adf8"/>
    <text x="122" y="17" fill="#b0b0b0" font-family="Inter, sans-serif" font-size="10">Sub-block scales</text>
    <rect x="210" y="5" width="15" height="15" rx="2" fill="#ffb400"/>
    <text x="232" y="17" fill="#b0b0b0" font-family="Inter, sans-serif" font-size="10">Weights</text>
  </g>
</svg>
